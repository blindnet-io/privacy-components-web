{"version":3,"file":"bldn-privacy-portal.js","sources":["../src/bldn-privacy-portal.ts"],"sourcesContent":["import { CoreConfigurationMixin, PrivacyRequestDemand } from '@blindnet/core';\nimport { bldnStyles } from '@blindnet/core-ui';\nimport { localized, msg } from '@lit/localize';\nimport { css, html, LitElement, PropertyValueMap } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\n\nimport './request-builder/bldn-request-builder.js';\nimport './request-viewer/bldn-request-viewer.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { when } from 'lit/directives/when.js';\nimport { setLocale } from './localization.js';\nimport { BldnRequestAddon } from './request-builder/request-modules/bldn-request-addon.js';\n\nenum DefaultDataCategories {\n  'ALL' = '*',\n  'AFFILIATION' = 'AFFILIATION',\n  'BEHAVIOR' = 'BEHAVIOR',\n  'BIOMETRIC' = 'BIOMETRIC',\n  'CONTACT' = 'CONTACT',\n  'DEMOGRAPHIC' = 'DEMOGRAPHIC',\n  'DEVICE' = 'DEVICE',\n  'FINANCIAL' = 'FINANCIAL',\n  'GENETIC' = 'GENETIC',\n  'HEALTH' = 'HEALTH',\n  'IMAGE' = 'IMAGE',\n  'LOCATION' = 'LOCATION',\n  'NAME' = 'NAME',\n  'PROFILING' = 'PROFILING',\n  'RELATIONSHIPS' = 'RELATIONSHIPS',\n  'UID' = 'UID',\n  'OTHER-DATA' = 'OTHER-DATA',\n}\n\nenum PrivacyPortalUIState {\n  createRequest,\n  submittedRequests,\n}\n\n@localized()\n@customElement('bldn-privacy-portal')\nexport class BldnPrivacyPortal extends CoreConfigurationMixin(LitElement) {\n  /** @prop */\n  @property({ type: Array }) actions: PrivacyRequestDemand.action[] = [];\n\n  /** @prop */\n  @property({ type: Array, attribute: 'data-categories' })\n  dataCategories: string[] = Object.values(DefaultDataCategories);\n\n  /** @prop */\n  @property({ type: Array }) requestId: undefined | string;\n\n  @state() _uiState: PrivacyPortalUIState = PrivacyPortalUIState.createRequest;\n\n  @state() _preAddons: Element[] = [];\n\n  @state() _postAddons: Element[] = [];\n\n  constructor() {\n    super();\n\n    // Set locale if current one is supported\n    try {\n      setLocale(navigator.language);\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.log(`Could not set locale to ${navigator.language}.`);\n    }\n\n    // Check if a requestId passed\n    const url = new URL(window.location.href);\n    const requestId = url.searchParams.get('requestId');\n    if (requestId) {\n      // Remove requestId from the URL after setting it\n      this.requestId = requestId;\n      url.searchParams.delete('requestId');\n      window.history.replaceState({}, '', url.href);\n    }\n  }\n\n  handleRequestIdChange() {\n    this._uiState = PrivacyPortalUIState.submittedRequests;\n  }\n\n  handleRequestSent(e: Event) {\n    const { requestId } = (e as CustomEvent).detail;\n    this.requestId = requestId;\n  }\n\n  handleNavClick(e: Event) {\n    const { value } = (e as CustomEvent).detail;\n    if (value === 'create') {\n      this._uiState = PrivacyPortalUIState.createRequest;\n    } else {\n      this.requestId = undefined;\n      this._uiState = PrivacyPortalUIState.submittedRequests;\n    }\n  }\n\n  /**\n   * Set the apiToken property when component catches the set event\n   * @param e CustomEvent containing the token in the details object\n   */\n  handleApiTokenEvent(e: Event) {\n    const { token } = (e as CustomEvent).detail;\n    if (token) {\n      this.apiToken = token;\n    }\n  }\n\n  handlePreAddonSlotChange(e: Event) {\n    const slots = (e.target as HTMLSlotElement).assignedElements();\n    // Check if any addons were slotted\n    if (\n      this._preAddons.length === 0 &&\n      slots.length !== 0 &&\n      slots.every(slot => slot instanceof BldnRequestAddon)\n    ) {\n      this._preAddons = slots;\n    }\n  }\n\n  handlePostAddonSlotChange(e: Event) {\n    const slots = (e.target as HTMLSlotElement).assignedElements();\n    // Check if any addons were slotted\n    if (\n      this._postAddons.length === 0 &&\n      slots.length !== 0 &&\n      slots.every(slot => slot instanceof BldnRequestAddon)\n    ) {\n      this._postAddons = slots;\n    }\n  }\n\n  protected willUpdate(\n    _changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>\n  ): void {\n    super.willUpdate(_changedProperties);\n    if (_changedProperties.has('requestId')) this.handleRequestIdChange();\n  }\n\n  connectedCallback(): void {\n    // eslint-disable-next-line wc/guard-super-call\n    super.connectedCallback();\n\n    this.addEventListener(\n      'bldn-priv-request-api-token:set',\n      this.handleApiTokenEvent\n    );\n  }\n\n  disconnectedCallback(): void {\n    // eslint-disable-next-line wc/guard-super-call\n    super.disconnectedCallback();\n\n    this.removeEventListener(\n      'bldn-priv-request-api-token:set',\n      this.handleApiTokenEvent\n    );\n  }\n\n  render() {\n    return html`\n      <bldn-nav-toggle\n        .left=${{\n          label: msg('Submit a Request'),\n          value: 'create',\n          checked: this._uiState === PrivacyPortalUIState.createRequest,\n        }}\n        .right=${{\n          label: msg('Submitted Requests'),\n          value: 'submitted',\n          checked: this._uiState === PrivacyPortalUIState.submittedRequests,\n        }}\n        @bldn-nav-toggle:click=${this.handleNavClick}\n      ></bldn-nav-toggle>\n      ${choose(this._uiState, [\n        [\n          PrivacyPortalUIState.createRequest,\n          () => html`\n            <bldn-request-builder\n              api-token=${ifDefined(this.apiToken)}\n              data-categories=${JSON.stringify(this.dataCategories)}\n              actions=${JSON.stringify(this.actions)}\n              @bldn-request-builder:request-sent=${this.handleRequestSent}\n            >\n              ${when(\n                this._preAddons.length > 0,\n                () => html` ${this._preAddons} `,\n                () => html`\n                  <slot\n                    name=\"preFormAddon\"\n                    slot=\"preFormAddon\"\n                    @slotchange=${this.handlePreAddonSlotChange}\n                    ><span><!-- Default Slot Content --></span></slot\n                  >\n                `\n              )}\n              ${when(\n                this._postAddons.length > 0,\n                () => html` ${this._postAddons} `,\n                () => html`\n                  <slot\n                    name=\"postFormAddon\"\n                    slot=\"postFormAddon\"\n                    @slotchange=${this.handlePostAddonSlotChange}\n                    ><span><!-- Default Slot Content --></span></slot\n                  >\n                `\n              )}\n            </bldn-request-builder>\n          `,\n        ],\n        [\n          PrivacyPortalUIState.submittedRequests,\n          () => html`\n            <bldn-request-viewer\n              request-id=${ifDefined(this.requestId)}\n            ></bldn-request-viewer>\n          `,\n        ],\n      ])}\n    `;\n  }\n\n  static styles = [\n    bldnStyles,\n    css`\n      :host {\n        display: block;\n        width: 100%;\n        background: var(--bldn-privacy-request-background, var(--background));\n      }\n\n      bldn-request-builder,\n      bldn-request-viewer {\n        margin-top: 2.5em;\n      }\n\n      bldn-request-viewer {\n        padding: 0 10%;\n      }\n    `,\n  ];\n}\n"],"names":[],"mappings":"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"}