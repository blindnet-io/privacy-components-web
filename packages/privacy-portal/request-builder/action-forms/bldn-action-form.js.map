{"version":3,"file":"bldn-action-form.js","sources":["../../../src/request-builder/action-forms/bldn-action-form.ts"],"sourcesContent":["import { msg, str } from '@lit/localize';\nimport { css, CSSResultGroup, html, LitElement, TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { when } from 'lit/directives/when.js';\nimport { PrivacyRequestDemand } from '@blindnet/core';\nimport '@blindnet/core-ui';\n\nimport '../bldn-nav-wrapper.js';\nimport {\n  ACTION_TITLES,\n  ACTION_TITLES_WITH_DEMAND,\n} from '../../utils/dictionary.js';\n\n/**\n * Abstract class for a form that allows the user to create or edit a demand.\n */\nexport abstract class ActionForm extends LitElement {\n  /** @prop */\n  @property({ type: Number, attribute: 'demand-group-index' })\n  demandGroupIndex: undefined | number;\n\n  /** @prop */\n  @property({ type: Array, attribute: 'demands' })\n  demands: PrivacyRequestDemand[] = this.getDefaultDemands();\n\n  /** Indicates that there is an error in the form input */\n  @state() hasError: boolean = false;\n\n  /** Error message for input in the main form section, set by the validateActionInput function defined for each form. */\n  @state() mainInputErrorMessage: undefined | string[];\n\n  /** Error message for input in the other options section, set by validateOptionsInput function defined for each form */\n  @state() optionsInputErrorMessage: undefined | string[];\n\n  /** PRIV Action of this form */\n  abstract readonly action: PrivacyRequestDemand.action;\n\n  readonly includeOptions: boolean = true;\n\n  /**\n   * Send a demand group up to the request builder\n   * @param demandGroupIndex index of the demand group to replace. If undefined,\n   * will be treated as a new group of demands.\n   * @param demand demands to add\n   */\n  addToPrivacyRequest(\n    demandGroupIndex: undefined | number,\n    demands: PrivacyRequestDemand[]\n  ) {\n    this.dispatchEvent(\n      new CustomEvent('bldn-action-form:set-demands', {\n        bubbles: true,\n        composed: true,\n        detail: {\n          demandGroupIndex,\n          demands,\n        },\n      })\n    );\n  }\n\n  handleBackClick() {\n    this.dispatchEvent(\n      new Event('bldn-action-form:back-click', {\n        bubbles: true,\n        composed: true,\n      })\n    );\n  }\n\n  /**\n   * Validate and add demand to request when add clicked\n   */\n  handleAddClick() {\n    // If form input is valid, add demands and emit event.\n    // Otherwise, error messages will be set.\n    if (this.validate()) {\n      this.addToPrivacyRequest(this.demandGroupIndex, this.demands!);\n      this.dispatchEvent(\n        new CustomEvent('bldn-action-form:next-click', {\n          bubbles: true,\n          composed: true,\n        })\n      );\n    }\n  }\n\n  /**\n   * Validate data entered and provide error message\n   * @return Boolean indicating if the input is valid and if it is not valid, an error message.\n   */\n  validate(): boolean {\n    this.mainInputErrorMessage = this.validateActionInput();\n    this.optionsInputErrorMessage = this.validateOptionsInput();\n    return (\n      this.mainInputErrorMessage === undefined &&\n      this.optionsInputErrorMessage === undefined\n    );\n  }\n\n  /**\n   * This method should return a list of error messages if the main content section of the\n   * form is not valid. Otherwise, it should return undefined.\n   */\n  abstract validateActionInput(): undefined | string[];\n\n  /**\n   * This method should return a list of error messages if the other options section of the\n   * form is not valid. Otherwise, it should return undefined.\n   */\n  abstract validateOptionsInput(): undefined | string[];\n\n  /**\n   * Get the main details section for this action form\n   * @returns HTML template for the main details section\n   */\n  abstract getFormTemplate(): TemplateResult;\n\n  /**\n   * Get the additional other options section for this action form\n   * @returns HTML template for the other options section\n   */\n  abstract getOptionsTemplate(): TemplateResult;\n\n  abstract getDefaultDemands(): PrivacyRequestDemand[];\n\n  render(): TemplateResult<1 | 2> {\n    return html`\n      <bldn-nav-wrapper\n        left-button=${msg('Back')}\n        right-button=${msg('Next')}\n        @bldn-nav-wrapper:left-click=${this.handleBackClick}\n        @bldn-nav-wrapper:right-click=${this.handleAddClick}\n      >\n        <bldn-dropdown class=\"main-section\" mode=\"major\" open>\n          <span slot=\"heading\"\n            ><strong\n              >${msg('Details of my', {\n                id: 'demand-form-action-sentence-start',\n              })}\n              ${ACTION_TITLES_WITH_DEMAND[this.action]()}\n            </strong></span\n          >\n          ${this.getFormTemplate()}\n        </bldn-dropdown>\n        ${when(\n          this.includeOptions,\n          () => html`\n            <bldn-dropdown class=\"main-section\" mode=\"major\">\n              <span slot=\"heading\"\n                ><strong>${msg('Other Options')}</strong></span\n              >\n              ${this.getOptionsTemplate()}\n            </bldn-dropdown>\n          `\n        )}\n      </bldn-nav-wrapper>\n    `;\n  }\n\n  static styles = [\n    css`\n      :host {\n        /* display: block; */\n        width: 100%;\n        margin: 0px;\n      }\n\n      bldn-dropdown.main-section {\n        border: 2px solid\n          var(--bldn-action-form-section-border-color, var(--color-light));\n        border-radius: 20px;\n        padding: 2.5em;\n        /* FIXME: This makes the border expansion jump weird */\n        /* transition: 0.3s ease-out; */\n      }\n\n      bldn-dropdown.main-section:not(:first-child) {\n        margin-top: 2.5em;\n      }\n\n      bldn-dropdown.main-section[open] {\n        padding: 2.5em 2.5em 0.5em 2.5em;\n      }\n\n      bldn-dropdown.main-section:hover {\n        border: 2px solid\n          var(\n            --bldn-action-form-section-border-color-hovered,\n            var(--color-dark)\n          );\n        /* FIXME: This makes the border expansion jump weird */\n        /* transition: 0.3s ease; */\n      }\n\n      /* Font for main sections: Demand Details and Other Options */\n      bldn-dropdown.main-section > span {\n        font-size: var(\n          --bldn-action-form-section-heading-font-size,\n          var(--font-size-medium)\n        );\n        color: var(\n          --bldn-action-form-section-heading-font-color,\n          var(--color-dark)\n        );\n      }\n\n      /* Padding in each other option dropdown */\n      bldn-dropdown bldn-dropdown[open] {\n        padding-bottom: 1.875em;\n      }\n\n      /* Font for other options headings */\n      bldn-dropdown bldn-dropdown span {\n        font-size: var(--font-size-small);\n        color: var(\n          --bldn-action-form-subsection-heading-font-color,\n          var(--color-dark)\n        );\n      }\n\n      bldn-dropdown bldn-dropdown span ~ * {\n        padding-left: 1.25em;\n      }\n\n      /* Divider between other options dropdowns */\n      bldn-dropdown {\n        border-bottom: 2px solid\n          var(\n            --bldn-action-form-subsection-divider-color,\n            var(--color-lightest)\n          );\n      }\n\n      /* Last dropdown in other options should have no border */\n      bldn-dropdown bldn-dropdown:last-child {\n        border-bottom: none;\n      }\n\n      bldn-nav-wrapper {\n        padding: 2.813em 2.813em 0em 2.813em;\n      }\n    ` as CSSResultGroup,\n  ];\n}\n"],"names":[],"mappings":"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"}