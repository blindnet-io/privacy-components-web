{"version":3,"file":"bldn-bridge.js","sources":["../src/bldn-bridge.ts"],"sourcesContent":["import { localized, msg } from '@lit/localize';\nimport { css, html, LitElement, PropertyValueMap } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\n\nimport '@blindnet/core-ui';\nimport './bldn-bridge-requests.js';\nimport './bldn-bridge-alerts.js';\n\nimport {\n  ComputationAPI,\n  CoreConfigurationMixin,\n  PendingDemandPayload,\n} from '@blindnet/core';\nimport { setLocale } from './localization.js';\n\nenum BridgeUIState {\n  requests,\n  alerts,\n}\n\n@localized()\n@customElement('bldn-bridge')\nexport class BldnBridge extends CoreConfigurationMixin(LitElement) {\n  @state() _uiState: BridgeUIState = BridgeUIState.requests;\n\n  @state() _demands: PendingDemandPayload[] = [];\n\n  constructor() {\n    super();\n\n    // Set locale if current one is supported\n    try {\n      setLocale(navigator.language);\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.log(`Could not set locale to ${navigator.language}.`);\n    }\n  }\n\n  handleViewToggleChange(e: CustomEvent) {\n    const { newValue } = e.detail;\n    this._uiState =\n      newValue === 'Alerts' ? BridgeUIState.alerts : BridgeUIState.requests;\n  }\n\n  connectedCallback() {\n    // eslint-disable-next-line wc/guard-super-call\n    super.connectedCallback();\n  }\n\n  protected willUpdate(\n    _changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>\n  ): void {\n    if (_changedProperties.has('adminToken') && this.adminToken) {\n      ComputationAPI.getInstance()\n        .getPendingDemands(this.adminToken)\n        .then(demands => {\n          this._demands = demands;\n        });\n    }\n  }\n\n  render() {\n    return html`\n      <bldn-toggle-button\n        left=${msg('Requests')}\n        right=${msg('Alerts')}\n        @bldn-toggle-button-change=${this.handleViewToggleChange}\n      ></bldn-toggle-button>\n      ${choose(this._uiState, [\n        [\n          BridgeUIState.requests,\n          () =>\n            html`<bldn-bridge-requests\n              demands=${JSON.stringify(this._demands)}\n            ></bldn-bridge-requests>`,\n        ],\n        [\n          BridgeUIState.alerts,\n          () => html`<bldn-bridge-alerts></bldn-bridge-alerts>`,\n        ],\n      ])}\n    `;\n  }\n\n  static styles = css`\n    :host {\n      display: block;\n      width: 100%;\n    }\n    bldn-toggle-button {\n      padding-bottom: 4vh;\n    }\n  `;\n}\n"],"names":[],"mappings":";;;;;;;;;;;AAgBA,IAAK,aAGJ,CAAA;AAHD,CAAA,UAAK,aAAa,EAAA;AAChB,IAAA,aAAA,CAAA,aAAA,CAAA,UAAA,CAAA,GAAA,CAAA,CAAA,GAAA,UAAQ,CAAA;AACR,IAAA,aAAA,CAAA,aAAA,CAAA,QAAA,CAAA,GAAA,CAAA,CAAA,GAAA,QAAM,CAAA;AACR,CAAC,EAHI,aAAa,KAAb,aAAa,GAGjB,EAAA,CAAA,CAAA,CAAA;AAIY,IAAA,UAAU,GAAhB,MAAM,UAAW,SAAQ,sBAAsB,CAAC,UAAU,CAAC,CAAA;AAKhE,IAAA,WAAA,GAAA;AACE,QAAA,KAAK,EAAE,CAAC;AALD,QAAA,IAAA,CAAA,QAAQ,GAAkB,aAAa,CAAC,QAAQ,CAAC;QAEjD,IAAQ,CAAA,QAAA,GAA2B,EAAE,CAAC;;QAM7C,IAAI;AACF,YAAA,SAAS,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;AAC/B,SAAA;AAAC,QAAA,OAAO,CAAC,EAAE;;YAEV,OAAO,CAAC,GAAG,CAAC,CAAA,wBAAA,EAA2B,SAAS,CAAC,QAAQ,CAAG,CAAA,CAAA,CAAC,CAAC;AAC/D,SAAA;KACF;AAED,IAAA,sBAAsB,CAAC,CAAc,EAAA;AACnC,QAAA,MAAM,EAAE,QAAQ,EAAE,GAAG,CAAC,CAAC,MAAM,CAAC;AAC9B,QAAA,IAAI,CAAC,QAAQ;AACX,YAAA,QAAQ,KAAK,QAAQ,GAAG,aAAa,CAAC,MAAM,GAAG,aAAa,CAAC,QAAQ,CAAC;KACzE;IAED,iBAAiB,GAAA;;QAEf,KAAK,CAAC,iBAAiB,EAAE,CAAC;KAC3B;AAES,IAAA,UAAU,CAClB,kBAAqE,EAAA;QAErE,IAAI,kBAAkB,CAAC,GAAG,CAAC,YAAY,CAAC,IAAI,IAAI,CAAC,UAAU,EAAE;YAC3D,cAAc,CAAC,WAAW,EAAE;AACzB,iBAAA,iBAAiB,CAAC,IAAI,CAAC,UAAU,CAAC;iBAClC,IAAI,CAAC,OAAO,IAAG;AACd,gBAAA,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;AAC1B,aAAC,CAAC,CAAC;AACN,SAAA;KACF;IAED,MAAM,GAAA;AACJ,QAAA,OAAO,IAAI,CAAA,CAAA;;eAEA,GAAG,CAAC,UAAU,CAAC,CAAA;gBACd,GAAG,CAAC,QAAQ,CAAC,CAAA;AACQ,mCAAA,EAAA,IAAI,CAAC,sBAAsB,CAAA;;AAExD,MAAA,EAAA,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;AACtB,YAAA;AACE,gBAAA,aAAa,CAAC,QAAQ;gBACtB,MACE,IAAI,CAAA,CAAA;AACQ,sBAAA,EAAA,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;AAChB,oCAAA,CAAA;AAC5B,aAAA;AACD,YAAA;AACE,gBAAA,aAAa,CAAC,MAAM;AACpB,gBAAA,MAAM,IAAI,CAAA,CAA2C,yCAAA,CAAA;AACtD,aAAA;SACF,CAAC,CAAA;KACH,CAAC;KACH;;AAEM,UAAM,CAAA,MAAA,GAAG,GAAG,CAAA,CAAA;;;;;;;;GAQlB,CAAC;AAtEO,UAAA,CAAA;AAAR,IAAA,KAAK,EAAE;AAAkD,CAAA,EAAA,UAAA,CAAA,SAAA,EAAA,UAAA,EAAA,KAAA,CAAA,CAAA,CAAA;AAEjD,UAAA,CAAA;AAAR,IAAA,KAAK,EAAE;AAAuC,CAAA,EAAA,UAAA,CAAA,SAAA,EAAA,UAAA,EAAA,KAAA,CAAA,CAAA,CAAA;AAHpC,UAAU,GAAA,UAAA,CAAA;AAFtB,IAAA,SAAS,EAAE;IACX,aAAa,CAAC,aAAa,CAAC;AAChB,CAAA,EAAA,UAAU,CAwEtB;;;;"}