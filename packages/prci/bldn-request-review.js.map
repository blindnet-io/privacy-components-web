{"version":3,"file":"bldn-request-review.js","sources":["../src/bldn-request-review.ts"],"sourcesContent":["import {\n  ComputationAPI,\n  CreatePrivacyRequestPayload,\n  GivenConsentsPayload,\n  PrivacyRequestDemand,\n  PrivacyScopeRestriction,\n  ProvenanceRestriction,\n} from '@blindnet/core';\nimport { msg, str } from '@lit/localize';\nimport { css, html, LitElement, PropertyValueMap, TemplateResult } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { map } from 'lit/directives/map.js';\nimport { when } from 'lit/directives/when.js';\n\nimport './bldn-nav-wrapper.js';\nimport './bldn-dropdown.js';\nimport './bldn-radio-list.js';\nimport {\n  DATA_CATEGORY_DESCRIPTIONS,\n  DATA_CATEGORY_TITLES,\n  PROCESSING_CATEGORIES,\n  PROCESSING_CATEGORY_DESCRIPTIONS,\n  PROVENANCE_DESCRIPTIONS,\n  PURPOSES,\n  PURPOSE_DESCRIPTIONS,\n  TARGET_DESCRIPTIONS,\n  TRANSPARENCY_ACTION_DESCRIPTIONS,\n} from './utils/dictionary.js';\n\nconst editSvg = new URL('./assets/icons/akar-icons_edit.svg', import.meta.url)\n  .href;\n\nconst deleteSvg = new URL(\n  './assets/icons/akar-icons_trash-can.svg',\n  import.meta.url\n).href;\n\n/**\n * @event {CustomEvent} bldn-request-review:edit-demands\n * @event {CustomEvent} bldn-request-review:delete-demands\n * @event {Event} bldn-request-review:cancel-request'\n * @event {Event} bldn-request-review:submit-request'\n */\n@customElement('bldn-request-review')\nexport class BldnRequestReview extends LitElement {\n  /** @prop */\n  @property({ type: Array }) demandGroups: PrivacyRequestDemand[][] = [];\n\n  @state() _consents: GivenConsentsPayload[] = [];\n\n  @state() _target: undefined | CreatePrivacyRequestPayload.target;\n\n  handleEditDemandGroupClick(demandGroupIndex: number) {\n    this.dispatchEvent(\n      new CustomEvent('bldn-request-review:edit-demands', {\n        bubbles: true,\n        composed: true,\n        detail: {\n          demandGroupIndex,\n        },\n      })\n    );\n  }\n\n  handleDeleteDemandGroupClick(demandGroupIndex: number) {\n    this.dispatchEvent(\n      new CustomEvent('bldn-request-review:delete-demands', {\n        bubbles: true,\n        composed: true,\n        detail: {\n          demandGroupIndex,\n        },\n      })\n    );\n  }\n\n  handleCancelClick() {\n    this.dispatchEvent(\n      new Event('bldn-request-review:cancel-request', {\n        bubbles: true,\n        composed: true,\n      })\n    );\n  }\n\n  handleSubmitClick() {\n    this.dispatchEvent(\n      new CustomEvent('bldn-request-review:submit-request', {\n        bubbles: true,\n        composed: true,\n        detail: {\n          target: this._target,\n        },\n      })\n    );\n  }\n\n  handleTargetChange(e: Event) {\n    e.stopPropagation();\n    const { value } = (e as CustomEvent).detail;\n    this._target = value;\n  }\n\n  getListTemplate(items: TemplateResult<1 | 2>[]) {\n    return html`\n      <ul>\n        ${map(items, item => html`<li>${item}</li>`)}\n      </ul>\n    `;\n  }\n\n  getPrivacyScopeListTemplate(\n    privacyScopes: undefined | PrivacyScopeRestriction[]\n  ) {\n    // Get unique values for each field of the privacy scope\n    const uniqueDataCategories = [...new Set(privacyScopes!.map(ps => ps.dc))];\n    const uniqueProcessingCategories = [\n      ...new Set(privacyScopes!.map(ps => ps.pc)),\n    ];\n    const uniquePurposes = [...new Set(privacyScopes!.map(ps => ps.pp))];\n\n    return html`\n      <p>${msg('Data Categories')}</p>\n      ${this.getListTemplate(\n        uniqueDataCategories.map(\n          dc => html`\n            ${dc === '*'\n              ? DATA_CATEGORY_DESCRIPTIONS[dc]()\n              : html`<b>${DATA_CATEGORY_TITLES[dc]()} Data:</b>\n                  ${DATA_CATEGORY_DESCRIPTIONS[dc]()}`}\n          `\n        )\n      )}\n      <p>${msg('Processing Categories')}</p>\n      ${this.getListTemplate(\n        uniqueProcessingCategories.map(\n          pc => html`\n            ${pc === PrivacyScopeRestriction.pc._\n              ? PROCESSING_CATEGORY_DESCRIPTIONS[pc]()\n              : html`<b>${PROCESSING_CATEGORIES[pc]()}:</b>\n                  ${PROCESSING_CATEGORY_DESCRIPTIONS[pc]()}`}\n          `\n        )\n      )}\n      <p>${msg('Purposes')}</p>\n      ${this.getListTemplate(\n        uniquePurposes.map(\n          pp => html`\n            ${pp === '*'\n              ? PURPOSE_DESCRIPTIONS[pp]()\n              : html`<b>${PURPOSES[pp]()}:</b> ${PURPOSE_DESCRIPTIONS[pp]()}`}\n          `\n        )\n      )}\n    `;\n  }\n\n  getDateRestrictionTemplate(demandGroup: PrivacyRequestDemand[]) {\n    const start = demandGroup[0].restrictions?.date_range?.from;\n    const end = demandGroup[0].restrictions?.date_range?.to;\n\n    if (start && end) {\n      return html`<p>\n        ${msg(\n          str`From ${new Date(start).toLocaleDateString()} to ${new Date(\n            end\n          ).toLocaleDateString()}`\n        )}\n      </p>`;\n    }\n    if (start) {\n      return html`<p>\n        ${msg(str`Since ${new Date(start).toLocaleDateString()}`)}\n      </p>`;\n    }\n    if (end) {\n      return html`<p>\n        ${msg(str`Up to ${new Date(end).toLocaleDateString()}`)}\n      </p>`;\n    }\n    return html`${msg('No valid dates!')}`;\n  }\n\n  getReviewTemplate(demandGroup: PrivacyRequestDemand[]) {\n    if (demandGroup.length > 0) {\n      const hasDateRestriction =\n        demandGroup[0].restrictions?.date_range?.to ||\n        demandGroup[0].restrictions?.date_range?.from;\n\n      const hasProvenanceRestriction =\n        demandGroup[0].restrictions?.provenance?.term &&\n        demandGroup[0].restrictions.provenance.term !==\n          ProvenanceRestriction.term._;\n\n      const hasAdditionalMessage =\n        demandGroup[0].message &&\n        demandGroup[0].action !== PrivacyRequestDemand.action.OTHER;\n\n      return html`\n        ${choose(\n          demandGroup[0].action,\n          [\n            [\n              PrivacyRequestDemand.action.ACCESS,\n              () => html`\n                <p>${msg('I want to access:')}</p>\n                ${this.getListTemplate(\n                  demandGroup[0].restrictions!.privacy_scope!.map(\n                    scope => html`\n                      ${scope.dc === '*'\n                        ? DATA_CATEGORY_DESCRIPTIONS[scope.dc]()\n                        : html`<b>${DATA_CATEGORY_TITLES[scope.dc]()} Data:</b>\n                            ${DATA_CATEGORY_DESCRIPTIONS[scope.dc]()}`}\n                    `\n                  )\n                )}\n              `,\n            ],\n            [\n              PrivacyRequestDemand.action.DELETE,\n              () => html`\n                <p>${msg('I want to delete:')}</p>\n                ${this.getListTemplate(\n                  demandGroup[0].restrictions!.privacy_scope!.map(\n                    scope => html`\n                      ${scope.dc === '*'\n                        ? DATA_CATEGORY_DESCRIPTIONS[scope.dc]()\n                        : html`<b>${DATA_CATEGORY_TITLES[scope.dc]()} Data:</b>\n                            ${DATA_CATEGORY_DESCRIPTIONS[scope.dc]()}`}\n                    `\n                  )\n                )}\n              `,\n            ],\n            [PrivacyRequestDemand.action.MODIFY, () => html``],\n            [\n              PrivacyRequestDemand.action.OBJECT,\n              () => html`\n                <p>\n                  ${msg(\n                    'I object to the processing of my data within the following scope:'\n                  )}\n                </p>\n                ${this.getPrivacyScopeListTemplate(\n                  demandGroup[0].restrictions?.privacy_scope\n                )}\n              `,\n            ],\n            [\n              PrivacyRequestDemand.action.RESTRICT,\n              () => html`\n                <p>\n                  ${msg(\n                    'I restrict the processing of my data to the following scope:'\n                  )}\n                </p>\n                ${this.getPrivacyScopeListTemplate(\n                  demandGroup[0].restrictions?.privacy_scope\n                )}\n              `,\n            ],\n            [\n              PrivacyRequestDemand.action.REVOKE_CONSENT,\n              () => html`\n                <p>${msg('I revoke the following consents:')}</p>\n                ${this.getListTemplate(\n                  this._consents\n                    .filter(\n                      c =>\n                        demandGroup.findIndex(\n                          demand => demand.restrictions!.consent!.id === c.id\n                        ) > -1\n                    )\n                    .map(\n                      c =>\n                        html`${c.name} -\n                          <i\n                            >${msg(\n                              html`Given on ${new Date(c.date).toLocaleString()}`\n                            )}</i\n                          >`\n                    )\n                )}\n              `,\n            ],\n            [\n              PrivacyRequestDemand.action.OTHER,\n              () => html`\n                <p>${msg('Details of my demand:')}</p>\n                <i>${demandGroup[0].message}</i>\n              `,\n            ],\n          ],\n          () => html`\n            ${when(\n              demandGroup[0].action.includes('TRANSPARENCY'),\n              () => html`\n                <p>${msg('I want to know:')}</p>\n                ${this.getListTemplate(\n                  demandGroup.map(\n                    demand => html`\n                      ${TRANSPARENCY_ACTION_DESCRIPTIONS[demand.action]()}\n                    `\n                  )\n                )}\n              `\n            )}\n          `\n        )}\n        <!-- Show other options selections if different than the default -->\n        ${when(\n          hasDateRestriction ||\n            hasProvenanceRestriction ||\n            hasAdditionalMessage,\n          () => html`\n            <p>${msg('Other options:')}</p>\n            <ul>\n              ${when(\n                hasDateRestriction,\n                () => html`\n                  <li><p>${msg('Date Restriction')}</p></li>\n                  ${this.getDateRestrictionTemplate(demandGroup)}\n                `\n              )}\n              ${when(\n                hasProvenanceRestriction,\n                () => html`\n                  <li><p>${msg('Provenance Restriction')}</p></li>\n                  ${PROVENANCE_DESCRIPTIONS[\n                    demandGroup[0].restrictions!.provenance!.term\n                  ]()}\n                `\n              )}\n              ${when(\n                hasAdditionalMessage,\n                () => html`\n                  <li><p>${msg('Other Message')}</p></li>\n                  ${demandGroup[0].message}\n                `\n              )}\n            </ul>\n          `\n        )}\n      `;\n    }\n    return html`${msg('No demands to review!')}`;\n  }\n\n  protected willUpdate(\n    _changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>\n  ): void {\n    if (\n      _changedProperties.has('demandGroups') &&\n      this.demandGroups.findIndex(\n        group =>\n          group.findIndex(\n            d => d.action === PrivacyRequestDemand.action.REVOKE_CONSENT\n          ) > 0\n      ) > 0\n    ) {\n      // Get consents\n      if (ComputationAPI.getInstance().apiTokenSet()) {\n        ComputationAPI.getInstance()\n          .getUserConsents()\n          .then(consents => {\n            this._consents = consents;\n          });\n      } else {\n        // TODO: Set some error message here that is the same for all forms\n        // eslint-disable-next-line no-console\n        console.log('User must be authenticated!');\n      }\n    }\n  }\n\n  render() {\n    return html`\n      <bldn-nav-wrapper\n        left-button=\"Cancel Request\"\n        right-button=\"Submit Request\"\n        @bldn-nav-wrapper:left-click=${this.handleCancelClick}\n        @bldn-nav-wrapper:right-click=${this.handleSubmitClick}\n      >\n        <bldn-dropdown class=\"main-section\" mode=\"major\" open>\n          <span slot=\"heading\"><strong>${msg('Request Summary')}</strong></span>\n          ${map(\n            this.demandGroups,\n            (group, i) => html`\n              ${when(\n                group.length > 0,\n                () => html`\n                  <bldn-dropdown>\n                    <span slot=\"heading\"\n                      ><strong\n                        >${group[0].action.split('.')[0]} ${msg(\n                  'Demand'\n                )}</strong\n                      >\n                      <button class='img-button' @click=${() =>\n                        this.handleEditDemandGroupClick(i)}>\n                        <img src=${editSvg} alt='edit demand group'></img>\n                      </button>\n                      <button class='img-button' @click=${() =>\n                        this.handleDeleteDemandGroupClick(i)}>\n                        <img src=${deleteSvg} alt='delete demand group'></img>\n                      </button>\n                    </span>\n                    ${this.getReviewTemplate(group)}\n                  </bldn-dropdown>\n                `\n              )}\n            `\n          )}\n        </bldn-dropdown>\n        <bldn-dropdown id=\"request-target\" class=\"main-section\" mode=\"major\">\n          <span slot=\"heading\"><strong>${msg('Request Target')}</strong></span>\n          <p>${msg('I address my Privacy Request to:')}</p>\n          <bldn-radio-list\n            .choices=${Object.values(CreatePrivacyRequestPayload.target).map(\n              target => ({\n                display: TARGET_DESCRIPTIONS[target](),\n                value: target,\n                checked: target === CreatePrivacyRequestPayload.target.PARTNERS,\n              })\n            )}\n            @bldn-radio-list:choice-change=${this.handleTargetChange}\n          ></bldn-radio-list>\n        </bldn-dropdown>\n      </bldn-nav-wrapper>\n    `;\n  }\n\n  static styles = css`\n    /* TODO: Update styles below so variables, etc. are unique to this component */\n\n    :host {\n      color: var(--bldn-request-review-font-color, var(--color-dark));\n      text-align: left;\n    }\n\n    #request-target bldn-radio-list {\n      padding-left: 1em;\n    }\n\n    li {\n      margin: 1em 0;\n    }\n\n    .img-button {\n      border: none;\n      background: none;\n    }\n\n    bldn-dropdown.main-section {\n      border: 2px solid\n        var(--bldn-request-review-section-border-color, var(--color-light));\n      border-radius: 20px;\n      padding: 2.5em;\n    }\n\n    bldn-dropdown.main-section[open] {\n      padding: 2.5em 2.5em 0.5em 2.5em;\n    }\n\n    bldn-dropdown.main-section:hover {\n      border: 2px solid\n        var(\n          --bldn-request-review-section-border-color-hovered,\n          var(--color-dark)\n        );\n      /* FIXME: This makes the border expansion jump weird */\n      /* transition: 0.3s ease; */\n    }\n\n    bldn-dropdown span {\n      display: inline-flex;\n      align-items: center;\n    }\n\n    /* Font for main sections: Demand Details and Other Options */\n    bldn-dropdown.main-section > span {\n      font-size: var(\n        --bldn-request-review-section-heading-font-size,\n        var(--font-size-medium)\n      );\n      color: var(\n        --bldn-request-review-section-heading-font-color,\n        var(--color-dark)\n      );\n    }\n\n    /* Padding in each other option dropdown */\n    bldn-dropdown bldn-dropdown[open] {\n      padding-bottom: 1em;\n    }\n\n    /* Font for other options headings */\n    bldn-dropdown bldn-dropdown span {\n      font-size: var(--font-size-small);\n      color: var(\n        --bldn-request-review-subsection-heading-font-color,\n        var(--color-dark)\n      );\n    }\n\n    /* Divider between other options dropdowns */\n    bldn-dropdown {\n      border-bottom: 2px solid\n        var(\n          --bldn-request-review-subsection-divider-color,\n          var(--color-lightest)\n        );\n    }\n\n    /* Last dropdown in other options should have no border */\n    bldn-dropdown bldn-dropdown:last-child {\n      border-bottom: none;\n    }\n\n    bldn-nav-wrapper {\n      padding: 2.813em 2.813em 0em 2.813em;\n    }\n  `;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;AA8BA,MAAM,OAAO,GAAG,IAAI,GAAG,CAAC,2DAAoC,EAAE,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC;AAC3E,KAAA,IAAI,CAAC;AAER,MAAM,SAAS,GAAG,IAAI,GAAG,CACvB,gEAAyC,EACzC,MAAM,CAAC,IAAI,CAAC,GAAG,CAChB,CAAC,IAAI,CAAC;AAEP;;;;;AAKG;AAEI,IAAM,iBAAiB,GAAvB,MAAM,iBAAkB,SAAQ,UAAU,CAAA;AAA1C,IAAA,WAAA,GAAA;;;QAEsB,IAAY,CAAA,YAAA,GAA6B,EAAE,CAAC;QAE9D,IAAS,CAAA,SAAA,GAA2B,EAAE,CAAC;KA2djD;AAvdC,IAAA,0BAA0B,CAAC,gBAAwB,EAAA;AACjD,QAAA,IAAI,CAAC,aAAa,CAChB,IAAI,WAAW,CAAC,kCAAkC,EAAE;AAClD,YAAA,OAAO,EAAE,IAAI;AACb,YAAA,QAAQ,EAAE,IAAI;AACd,YAAA,MAAM,EAAE;gBACN,gBAAgB;AACjB,aAAA;AACF,SAAA,CAAC,CACH,CAAC;KACH;AAED,IAAA,4BAA4B,CAAC,gBAAwB,EAAA;AACnD,QAAA,IAAI,CAAC,aAAa,CAChB,IAAI,WAAW,CAAC,oCAAoC,EAAE;AACpD,YAAA,OAAO,EAAE,IAAI;AACb,YAAA,QAAQ,EAAE,IAAI;AACd,YAAA,MAAM,EAAE;gBACN,gBAAgB;AACjB,aAAA;AACF,SAAA,CAAC,CACH,CAAC;KACH;IAED,iBAAiB,GAAA;AACf,QAAA,IAAI,CAAC,aAAa,CAChB,IAAI,KAAK,CAAC,oCAAoC,EAAE;AAC9C,YAAA,OAAO,EAAE,IAAI;AACb,YAAA,QAAQ,EAAE,IAAI;AACf,SAAA,CAAC,CACH,CAAC;KACH;IAED,iBAAiB,GAAA;AACf,QAAA,IAAI,CAAC,aAAa,CAChB,IAAI,WAAW,CAAC,oCAAoC,EAAE;AACpD,YAAA,OAAO,EAAE,IAAI;AACb,YAAA,QAAQ,EAAE,IAAI;AACd,YAAA,MAAM,EAAE;gBACN,MAAM,EAAE,IAAI,CAAC,OAAO;AACrB,aAAA;AACF,SAAA,CAAC,CACH,CAAC;KACH;AAED,IAAA,kBAAkB,CAAC,CAAQ,EAAA;QACzB,CAAC,CAAC,eAAe,EAAE,CAAC;AACpB,QAAA,MAAM,EAAE,KAAK,EAAE,GAAI,CAAiB,CAAC,MAAM,CAAC;AAC5C,QAAA,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;KACtB;AAED,IAAA,eAAe,CAAC,KAA8B,EAAA;AAC5C,QAAA,OAAO,IAAI,CAAA,CAAA;;AAEL,QAAA,EAAA,GAAG,CAAC,KAAK,EAAE,IAAI,IAAI,IAAI,CAAA,CAAA,IAAA,EAAO,IAAI,CAAA,KAAA,CAAO,CAAC,CAAA;;KAE/C,CAAC;KACH;AAED,IAAA,2BAA2B,CACzB,aAAoD,EAAA;;QAGpD,MAAM,oBAAoB,GAAG,CAAC,GAAG,IAAI,GAAG,CAAC,aAAc,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAC3E,QAAA,MAAM,0BAA0B,GAAG;AACjC,YAAA,GAAG,IAAI,GAAG,CAAC,aAAc,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC;SAC5C,CAAC;QACF,MAAM,cAAc,GAAG,CAAC,GAAG,IAAI,GAAG,CAAC,aAAc,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAErE,QAAA,OAAO,IAAI,CAAA,CAAA;WACJ,GAAG,CAAC,iBAAiB,CAAC,CAAA;AACzB,MAAA,EAAA,IAAI,CAAC,eAAe,CACpB,oBAAoB,CAAC,GAAG,CACtB,EAAE,IAAI,IAAI,CAAA,CAAA;AACN,YAAA,EAAA,EAAE,KAAK,GAAG;AACV,cAAE,0BAA0B,CAAC,EAAE,CAAC,EAAE;cAChC,IAAI,CAAA,CAAA,GAAA,EAAM,oBAAoB,CAAC,EAAE,CAAC,EAAE,CAAA;AAChC,kBAAA,EAAA,0BAA0B,CAAC,EAAE,CAAC,EAAE,CAAE,CAAA,CAAA;AAC3C,UAAA,CAAA,CACF,CACF,CAAA;WACI,GAAG,CAAC,uBAAuB,CAAC,CAAA;AAC/B,MAAA,EAAA,IAAI,CAAC,eAAe,CACpB,0BAA0B,CAAC,GAAG,CAC5B,EAAE,IAAI,IAAI,CAAA,CAAA;AACN,YAAA,EAAA,EAAE,KAAK,uBAAuB,CAAC,EAAE,CAAC,CAAC;AACnC,cAAE,gCAAgC,CAAC,EAAE,CAAC,EAAE;cACtC,IAAI,CAAA,CAAA,GAAA,EAAM,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAA;AACjC,kBAAA,EAAA,gCAAgC,CAAC,EAAE,CAAC,EAAE,CAAE,CAAA,CAAA;AACjD,UAAA,CAAA,CACF,CACF,CAAA;WACI,GAAG,CAAC,UAAU,CAAC,CAAA;AAClB,MAAA,EAAA,IAAI,CAAC,eAAe,CACpB,cAAc,CAAC,GAAG,CAChB,EAAE,IAAI,IAAI,CAAA,CAAA;AACN,YAAA,EAAA,EAAE,KAAK,GAAG;AACV,cAAE,oBAAoB,CAAC,EAAE,CAAC,EAAE;AAC5B,cAAE,IAAI,CAAA,CAAA,GAAA,EAAM,QAAQ,CAAC,EAAE,CAAC,EAAE,SAAS,oBAAoB,CAAC,EAAE,CAAC,EAAE,CAAE,CAAA,CAAA;AAClE,UAAA,CAAA,CACF,CACF,CAAA;KACF,CAAC;KACH;AAED,IAAA,0BAA0B,CAAC,WAAmC,EAAA;;AAC5D,QAAA,MAAM,KAAK,GAAG,CAAA,EAAA,GAAA,CAAA,EAAA,GAAA,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAE,UAAU,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAE,IAAI,CAAC;AAC5D,QAAA,MAAM,GAAG,GAAG,CAAA,EAAA,GAAA,CAAA,EAAA,GAAA,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAE,UAAU,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAE,EAAE,CAAC;QAExD,IAAI,KAAK,IAAI,GAAG,EAAE;AAChB,YAAA,OAAO,IAAI,CAAA,CAAA;UACP,GAAG,CACH,GAAG,CAAA,CAAA,KAAA,EAAQ,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,kBAAkB,EAAE,CAAO,IAAA,EAAA,IAAI,IAAI,CAC5D,GAAG,CACJ,CAAC,kBAAkB,EAAE,CAAA,CAAE,CACzB,CAAA;WACE,CAAC;AACP,SAAA;AACD,QAAA,IAAI,KAAK,EAAE;AACT,YAAA,OAAO,IAAI,CAAA,CAAA;AACP,QAAA,EAAA,GAAG,CAAC,GAAG,CAAA,CAAA,MAAA,EAAS,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,kBAAkB,EAAE,EAAE,CAAC,CAAA;WACtD,CAAC;AACP,SAAA;AACD,QAAA,IAAI,GAAG,EAAE;AACP,YAAA,OAAO,IAAI,CAAA,CAAA;AACP,QAAA,EAAA,GAAG,CAAC,GAAG,CAAA,CAAA,MAAA,EAAS,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC,kBAAkB,EAAE,EAAE,CAAC,CAAA;WACpD,CAAC;AACP,SAAA;QACD,OAAO,IAAI,CAAA,CAAG,EAAA,GAAG,CAAC,iBAAiB,CAAC,EAAE,CAAC;KACxC;AAED,IAAA,iBAAiB,CAAC,WAAmC,EAAA;;AACnD,QAAA,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE;AAC1B,YAAA,MAAM,kBAAkB,GACtB,CAAA,CAAA,EAAA,GAAA,MAAA,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,MAAE,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,UAAU,0CAAE,EAAE;AAC3C,iBAAA,CAAA,EAAA,GAAA,CAAA,EAAA,GAAA,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAE,UAAU,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAE,IAAI,CAAA,CAAC;AAEhD,YAAA,MAAM,wBAAwB,GAC5B,CAAA,CAAA,EAAA,GAAA,MAAA,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,MAAE,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,UAAU,0CAAE,IAAI;gBAC7C,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,UAAU,CAAC,IAAI;AACzC,oBAAA,qBAAqB,CAAC,IAAI,CAAC,CAAC,CAAC;AAEjC,YAAA,MAAM,oBAAoB,GACxB,WAAW,CAAC,CAAC,CAAC,CAAC,OAAO;gBACtB,WAAW,CAAC,CAAC,CAAC,CAAC,MAAM,KAAK,oBAAoB,CAAC,MAAM,CAAC,KAAK,CAAC;AAE9D,YAAA,OAAO,IAAI,CAAA,CAAA;AACP,QAAA,EAAA,MAAM,CACN,WAAW,CAAC,CAAC,CAAC,CAAC,MAAM,EACrB;AACE,gBAAA;oBACE,oBAAoB,CAAC,MAAM,CAAC,MAAM;oBAClC,MAAM,IAAI,CAAA,CAAA;qBACH,GAAG,CAAC,mBAAmB,CAAC,CAAA;AAC3B,gBAAA,EAAA,IAAI,CAAC,eAAe,CACpB,WAAW,CAAC,CAAC,CAAC,CAAC,YAAa,CAAC,aAAc,CAAC,GAAG,CAC7C,KAAK,IAAI,IAAI,CAAA,CAAA;wBACT,KAAK,CAAC,EAAE,KAAK,GAAG;AAChB,0BAAE,0BAA0B,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE;0BACtC,IAAI,CAAA,CAAM,GAAA,EAAA,oBAAoB,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAA;AACtC,4BAAA,EAAA,0BAA0B,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAE,CAAA,CAAA;AACjD,oBAAA,CAAA,CACF,CACF,CAAA;AACF,cAAA,CAAA;AACF,iBAAA;AACD,gBAAA;oBACE,oBAAoB,CAAC,MAAM,CAAC,MAAM;oBAClC,MAAM,IAAI,CAAA,CAAA;qBACH,GAAG,CAAC,mBAAmB,CAAC,CAAA;AAC3B,gBAAA,EAAA,IAAI,CAAC,eAAe,CACpB,WAAW,CAAC,CAAC,CAAC,CAAC,YAAa,CAAC,aAAc,CAAC,GAAG,CAC7C,KAAK,IAAI,IAAI,CAAA,CAAA;wBACT,KAAK,CAAC,EAAE,KAAK,GAAG;AAChB,0BAAE,0BAA0B,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE;0BACtC,IAAI,CAAA,CAAM,GAAA,EAAA,oBAAoB,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAA;AACtC,4BAAA,EAAA,0BAA0B,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAE,CAAA,CAAA;AACjD,oBAAA,CAAA,CACF,CACF,CAAA;AACF,cAAA,CAAA;AACF,iBAAA;AACD,gBAAA,CAAC,oBAAoB,CAAC,MAAM,CAAC,MAAM,EAAE,MAAM,IAAI,CAAA,CAAA,CAAE,CAAC;AAClD,gBAAA;oBACE,oBAAoB,CAAC,MAAM,CAAC,MAAM;AAClC,oBAAA,MAAK;;AAAC,wBAAA,OAAA,IAAI,CAAA,CAAA;;oBAEJ,GAAG,CACH,mEAAmE,CACpE,CAAA;;AAED,gBAAA,EAAA,IAAI,CAAC,2BAA2B,CAChC,CAAA,EAAA,GAAA,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,MAAE,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,aAAa,CAC3C,CAAA;eACF,CAAA;AAAA,qBAAA;AACF,iBAAA;AACD,gBAAA;oBACE,oBAAoB,CAAC,MAAM,CAAC,QAAQ;AACpC,oBAAA,MAAK;;AAAC,wBAAA,OAAA,IAAI,CAAA,CAAA;;oBAEJ,GAAG,CACH,8DAA8D,CAC/D,CAAA;;AAED,gBAAA,EAAA,IAAI,CAAC,2BAA2B,CAChC,CAAA,EAAA,GAAA,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,MAAE,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,aAAa,CAC3C,CAAA;eACF,CAAA;AAAA,qBAAA;AACF,iBAAA;AACD,gBAAA;oBACE,oBAAoB,CAAC,MAAM,CAAC,cAAc;oBAC1C,MAAM,IAAI,CAAA,CAAA;qBACH,GAAG,CAAC,kCAAkC,CAAC,CAAA;AAC1C,gBAAA,EAAA,IAAI,CAAC,eAAe,CACpB,IAAI,CAAC,SAAS;AACX,yBAAA,MAAM,CACL,CAAC,IACC,WAAW,CAAC,SAAS,CACnB,MAAM,IAAI,MAAM,CAAC,YAAa,CAAC,OAAQ,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,CACpD,GAAG,CAAC,CAAC,CACT;yBACA,GAAG,CACF,CAAC,IACC,IAAI,CAAA,CAAA,EAAG,CAAC,CAAC,IAAI,CAAA;;AAEN,6BAAA,EAAA,GAAG,CACJ,IAAI,CAAA,CAAA,SAAA,EAAY,IAAI,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,cAAc,EAAE,EAAE,CACpD,CAAA;AACD,2BAAA,CAAA,CACP,CACJ,CAAA;AACF,cAAA,CAAA;AACF,iBAAA;AACD,gBAAA;oBACE,oBAAoB,CAAC,MAAM,CAAC,KAAK;oBACjC,MAAM,IAAI,CAAA,CAAA;qBACH,GAAG,CAAC,uBAAuB,CAAC,CAAA;AAC5B,mBAAA,EAAA,WAAW,CAAC,CAAC,CAAC,CAAC,OAAO,CAAA;AAC5B,cAAA,CAAA;AACF,iBAAA;AACF,aAAA,EACD,MAAM,IAAI,CAAA,CAAA;AACN,YAAA,EAAA,IAAI,CACJ,WAAW,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,EAC9C,MAAM,IAAI,CAAA,CAAA;qBACH,GAAG,CAAC,iBAAiB,CAAC,CAAA;AACzB,gBAAA,EAAA,IAAI,CAAC,eAAe,CACpB,WAAW,CAAC,GAAG,CACb,MAAM,IAAI,IAAI,CAAA,CAAA;AACV,sBAAA,EAAA,gCAAgC,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,CAAA;AACpD,oBAAA,CAAA,CACF,CACF,CAAA;eACF,CACF,CAAA;WACF,CACF,CAAA;;AAEC,QAAA,EAAA,IAAI,CACJ,kBAAkB;gBAChB,wBAAwB;AACxB,gBAAA,oBAAoB,EACtB,MAAM,IAAI,CAAA,CAAA;iBACH,GAAG,CAAC,gBAAgB,CAAC,CAAA;;AAEtB,cAAA,EAAA,IAAI,CACJ,kBAAkB,EAClB,MAAM,IAAI,CAAA,CAAA;2BACC,GAAG,CAAC,kBAAkB,CAAC,CAAA;AAC9B,kBAAA,EAAA,IAAI,CAAC,0BAA0B,CAAC,WAAW,CAAC,CAAA;iBAC/C,CACF,CAAA;AACC,cAAA,EAAA,IAAI,CACJ,wBAAwB,EACxB,MAAM,IAAI,CAAA,CAAA;2BACC,GAAG,CAAC,wBAAwB,CAAC,CAAA;AACpC,kBAAA,EAAA,uBAAuB,CACvB,WAAW,CAAC,CAAC,CAAC,CAAC,YAAa,CAAC,UAAW,CAAC,IAAI,CAC9C,EAAE,CAAA;iBACJ,CACF,CAAA;AACC,cAAA,EAAA,IAAI,CACJ,oBAAoB,EACpB,MAAM,IAAI,CAAA,CAAA;2BACC,GAAG,CAAC,eAAe,CAAC,CAAA;AAC3B,kBAAA,EAAA,WAAW,CAAC,CAAC,CAAC,CAAC,OAAO,CAAA;iBACzB,CACF,CAAA;;WAEJ,CACF,CAAA;OACF,CAAC;AACH,SAAA;QACD,OAAO,IAAI,CAAA,CAAG,EAAA,GAAG,CAAC,uBAAuB,CAAC,EAAE,CAAC;KAC9C;AAES,IAAA,UAAU,CAClB,kBAAqE,EAAA;AAErE,QAAA,IACE,kBAAkB,CAAC,GAAG,CAAC,cAAc,CAAC;AACtC,YAAA,IAAI,CAAC,YAAY,CAAC,SAAS,CACzB,KAAK,IACH,KAAK,CAAC,SAAS,CACb,CAAC,IAAI,CAAC,CAAC,MAAM,KAAK,oBAAoB,CAAC,MAAM,CAAC,cAAc,CAC7D,GAAG,CAAC,CACR,GAAG,CAAC,EACL;;AAEA,YAAA,IAAI,cAAc,CAAC,WAAW,EAAE,CAAC,WAAW,EAAE,EAAE;gBAC9C,cAAc,CAAC,WAAW,EAAE;AACzB,qBAAA,eAAe,EAAE;qBACjB,IAAI,CAAC,QAAQ,IAAG;AACf,oBAAA,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;AAC5B,iBAAC,CAAC,CAAC;AACN,aAAA;AAAM,iBAAA;;;AAGL,gBAAA,OAAO,CAAC,GAAG,CAAC,6BAA6B,CAAC,CAAC;AAC5C,aAAA;AACF,SAAA;KACF;IAED,MAAM,GAAA;AACJ,QAAA,OAAO,IAAI,CAAA,CAAA;;;;AAIwB,qCAAA,EAAA,IAAI,CAAC,iBAAiB,CAAA;AACrB,sCAAA,EAAA,IAAI,CAAC,iBAAiB,CAAA;;;yCAGrB,GAAG,CAAC,iBAAiB,CAAC,CAAA;AACnD,UAAA,EAAA,GAAG,CACH,IAAI,CAAC,YAAY,EACjB,CAAC,KAAK,EAAE,CAAC,KAAK,IAAI,CAAA,CAAA;gBACd,IAAI,CACJ,KAAK,CAAC,MAAM,GAAG,CAAC,EAChB,MAAM,IAAI,CAAA,CAAA;;;;AAIC,yBAAA,EAAA,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,GAAG,CAC7C,QAAQ,CACT,CAAA;;AAEyC,wDAAA,EAAA,MAClC,IAAI,CAAC,0BAA0B,CAAC,CAAC,CAAC,CAAA;mCACvB,OAAO,CAAA;;AAEgB,wDAAA,EAAA,MAClC,IAAI,CAAC,4BAA4B,CAAC,CAAC,CAAC,CAAA;mCACzB,SAAS,CAAA;;;AAGtB,oBAAA,EAAA,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAA;;iBAElC,CACF,CAAA;aACF,CACF,CAAA;;;yCAG8B,GAAG,CAAC,gBAAgB,CAAC,CAAA;eAC/C,GAAG,CAAC,kCAAkC,CAAC,CAAA;;AAE/B,qBAAA,EAAA,MAAM,CAAC,MAAM,CAAC,2BAA2B,CAAC,MAAM,CAAC,CAAC,GAAG,CAC9D,MAAM,KAAK;AACT,YAAA,OAAO,EAAE,mBAAmB,CAAC,MAAM,CAAC,EAAE;AACtC,YAAA,KAAK,EAAE,MAAM;AACb,YAAA,OAAO,EAAE,MAAM,KAAK,2BAA2B,CAAC,MAAM,CAAC,QAAQ;AAChE,SAAA,CAAC,CACH,CAAA;AACgC,2CAAA,EAAA,IAAI,CAAC,kBAAkB,CAAA;;;;KAI/D,CAAC;KACH;;AAEM,iBAAM,CAAA,MAAA,GAAG,GAAG,CAAA,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA0FlB,CAAC;AA5dyB,UAAA,CAAA;AAA1B,IAAA,QAAQ,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC;AAA6C,CAAA,EAAA,iBAAA,CAAA,SAAA,EAAA,cAAA,EAAA,KAAA,CAAA,CAAA,CAAA;AAE9D,UAAA,CAAA;AAAR,IAAA,KAAK,EAAE;AAAwC,CAAA,EAAA,iBAAA,CAAA,SAAA,EAAA,WAAA,EAAA,KAAA,CAAA,CAAA,CAAA;AAEvC,UAAA,CAAA;AAAR,IAAA,KAAK,EAAE;AAAyD,CAAA,EAAA,iBAAA,CAAA,SAAA,EAAA,SAAA,EAAA,KAAA,CAAA,CAAA,CAAA;AANtD,iBAAiB,GAAA,UAAA,CAAA;IAD7B,aAAa,CAAC,qBAAqB,CAAC;AACxB,CAAA,EAAA,iBAAiB,CA+d7B;;;;"}