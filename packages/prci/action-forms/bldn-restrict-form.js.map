{"version":3,"file":"bldn-restrict-form.js","sources":["../../src/action-forms/bldn-restrict-form.ts"],"sourcesContent":["import {\n  PrivacyRequestDemand,\n  PrivacyScopeRestriction,\n  ProvenanceRestriction,\n} from '@blindnet/core';\nimport { msg } from '@lit/localize';\nimport { css, html, TemplateResult } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\n\nimport { ActionForm } from './bldn-action-form.js';\nimport '../bldn-privacy-scope-picker.js';\nimport {\n  DATA_CATEGORY_DESCRIPTIONS,\n  DATA_CATEGORY_TITLES,\n  PROCESSING_CATEGORIES,\n  PROCESSING_CATEGORY_DESCRIPTIONS,\n  PURPOSES,\n  PURPOSE_DESCRIPTIONS,\n} from '../utils/dictionary.js';\n\n/**\n * Action form for the RESTRICT PRIV Action\n */\n@customElement('bldn-restrict-form')\nexport class BldnRestrictForm extends ActionForm {\n  /** @prop List of allowed data categories */\n  @property({ type: Array, attribute: 'data-categories' })\n  dataCategories: string[] = [];\n\n  /** @prop List of allowed processing categories */\n  @property({ type: Array, attribute: 'processing-categories' })\n  processingCategories: PrivacyScopeRestriction.pc[] = [];\n\n  /** @prop List of allowed purposes of processing */\n  @property({ type: Array, attribute: 'purposes' })\n  purposes: PrivacyScopeRestriction.pp[] = [];\n\n  action: PrivacyRequestDemand.action = PrivacyRequestDemand.action.RESTRICT;\n\n  validateActionInput(): string[] | undefined {\n    return undefined;\n  }\n\n  validateOptionsInput(): string[] | undefined {\n    return undefined;\n  }\n\n  getFormTemplate(): TemplateResult<1 | 2> {\n    return html`\n      <blnd-privacy-scope-picker\n        mode=\"restrict\"\n        .privacyScope=${this.demands[0].restrictions!.privacy_scope}\n        .dataCategories=${this.dataCategories.map(dc => ({\n          value: dc,\n          display:\n            dc === '*'\n              ? html`${DATA_CATEGORY_DESCRIPTIONS[dc]()}`\n              : html`<b>${DATA_CATEGORY_TITLES[dc]()} ${msg('Data')}:</b>\n                  ${DATA_CATEGORY_DESCRIPTIONS[dc]()}`,\n          allChoice: dc === '*',\n        }))}\n        .processingCategories=${this.processingCategories.map(pc => ({\n          value: pc,\n          display:\n            pc === '*'\n              ? html`${PROCESSING_CATEGORY_DESCRIPTIONS[pc]()}`\n              : html`<b>${PROCESSING_CATEGORIES[pc]()}:</b>\n                  ${PROCESSING_CATEGORY_DESCRIPTIONS[pc]()}`,\n          allChoice: pc === '*',\n        }))}\n        .purposes=${this.purposes.map(pp => ({\n          value: pp,\n          display:\n            pp === '*'\n              ? html`${PURPOSE_DESCRIPTIONS[pp]()}`\n              : html`<b>${PURPOSES[pp]()}:</b> ${PURPOSE_DESCRIPTIONS[pp]()}`,\n          allChoice: pp === '*',\n        }))}\n      ></blnd-privacy-scope-picker>\n    `;\n  }\n\n  getOptionsTemplate(): TemplateResult<1 | 2> {\n    return html`\n      <bldn-dropdown>\n        <span slot=\"heading\"><strong>${msg('Date Restriction')}</strong></span>\n        <bldn-date-restriction\n          start=${ifDefined(this.demands[0].restrictions?.date_range?.from)}\n          end=${ifDefined(this.demands[0].restrictions?.date_range?.to)}\n        ></bldn-date-restriction>\n      </bldn-dropdown>\n      <bldn-dropdown>\n        <span slot=\"heading\"\n          ><strong>${msg('Provenance Restriction')}</strong></span\n        >\n        <bldn-provenance-restriction\n          term=${ifDefined(this.demands[0].restrictions?.provenance?.term)}\n        ></bldn-provenance-restriction>\n      </bldn-dropdown>\n      <bldn-dropdown>\n        <span slot=\"heading\"\n          ><strong>${msg('Additional Message')}</strong></span\n        >\n        <bldn-additional-message\n          message=${ifDefined(this.demands[0].message)}\n        ></bldn-additional-message>\n      </bldn-dropdown>\n    `;\n  }\n\n  getDefaultDemands(): PrivacyRequestDemand[] {\n    return [\n      {\n        id: '',\n        action: PrivacyRequestDemand.action.RESTRICT,\n        restrictions: {\n          privacy_scope: [\n            {\n              dc: '*',\n              pc: PrivacyScopeRestriction.pc._,\n              pp: PrivacyScopeRestriction.pp._,\n            },\n          ],\n          provenance: {\n            term: ProvenanceRestriction.term._,\n          },\n          date_range: {},\n        },\n      },\n    ];\n  }\n\n  // Listener Functions\n\n  /**\n   * Update the privacy scope restriction for this demand\n   * @param e {CustomEvent} Event containing the new privacy scope restriction\n   */\n  changePrivacyScopeRestriction(e: Event) {\n    e.stopPropagation();\n    const { privacyScope } = (e as CustomEvent).detail;\n    this.demands[0].restrictions!.privacy_scope = privacyScope;\n  }\n\n  /**\n   * Update the date restriction start for this demand\n   * @param e {CustomEvent} Event containing the new start date\n   */\n  changeDateRestrictionStart(e: Event) {\n    e.stopPropagation();\n    const { date } = (e as CustomEvent).detail;\n    this.demands[0].restrictions!.date_range!.from = date;\n  }\n\n  /**\n   * Update the date restriction end for this demand\n   * @param e {CustomEvent} Event containing the new end date\n   */\n  changeDateRestrictionEnd(e: Event) {\n    e.stopPropagation();\n    const { date } = (e as CustomEvent).detail;\n    this.demands[0].restrictions!.date_range!.to = date;\n  }\n\n  /**\n   * Update the provenance restriction term for this demand\n   * @param e {CustomEvent} Event containing the new provenance restriction term\n   */\n  changeProvenanceRestrictionTerm(e: Event) {\n    e.stopPropagation();\n    const { term } = (e as CustomEvent).detail;\n    this.demands[0].restrictions!.provenance!.term = term;\n  }\n\n  /**\n   * Update the message for this demand\n   * @param e {CustomEvent} Event containing the data category string to add\n   */\n  changeMessage(e: Event) {\n    e.stopPropagation();\n    const { message } = (e as CustomEvent).detail;\n    this.demands[0].message = message;\n  }\n\n  /**\n   * Add listeners for elements of this ActionForm\n   */\n  connectedCallback(): void {\n    // eslint-disable-next-line wc/guard-super-call\n    super.connectedCallback();\n\n    // Privacy scope restriction listener\n    this.addEventListener(\n      'bldn-privacy-scope-picker:scope-change',\n      this.changePrivacyScopeRestriction\n    );\n\n    // Date restriction listeners\n    this.addEventListener(\n      'bldn-date-restriction:start-date-change',\n      this.changeDateRestrictionStart\n    );\n    this.addEventListener(\n      'bldn-date-restriction:end-date-change',\n      this.changeDateRestrictionEnd\n    );\n\n    // Provenance restriction listener\n    this.addEventListener(\n      'bldn-provenance-restriction:term-change',\n      this.changeProvenanceRestrictionTerm\n    );\n\n    // Message listener\n    this.addEventListener(\n      'bldn-additional-message:message-change',\n      this.changeMessage\n    );\n  }\n\n  /**\n   * Remove all listeners\n   */\n  disconnectedCallback(): void {\n    this.removeEventListener(\n      'bldn-privacy-scope-picker:scope-change',\n      this.changePrivacyScopeRestriction\n    );\n    this.removeEventListener(\n      'bldn-date-restriction:start-date-change',\n      this.changeDateRestrictionStart\n    );\n    this.removeEventListener(\n      'bldn-date-restriction:end-date-change',\n      this.changeDateRestrictionEnd\n    );\n    this.removeEventListener(\n      'bldn-provenance-restriction:term-change',\n      this.changeProvenanceRestrictionTerm\n    );\n    this.removeEventListener(\n      'bldn-additional-message:message-change',\n      this.changeMessage\n    );\n  }\n\n  static styles = [ActionForm.styles, css``];\n}\n"],"names":[],"mappings":"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"}