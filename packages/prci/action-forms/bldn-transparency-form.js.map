{"version":3,"file":"bldn-transparency-form.js","sources":["../../src/action-forms/bldn-transparency-form.ts"],"sourcesContent":["/* eslint-disable no-param-reassign */\nimport {\n  PrivacyRequestDemand,\n  ProvenanceRestriction,\n  Restrictions,\n} from '@blindnet/core';\nimport { css, html, PropertyValueMap, TemplateResult } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { msg } from '@lit/localize';\n\nimport { ActionForm } from './bldn-action-form.js';\nimport '../bldn-all-checklist.js';\nimport { TRANSPARENCY_ACTION_DESCRIPTIONS } from '../utils/dictionary.js';\n\n/**\n * Action form for the TRANSPARENCY PRIV Action\n */\n@customElement('bldn-transparency-form')\nexport class BldnTransparencyForm extends ActionForm {\n  /** @prop */\n  @property({ type: Array, attribute: 'transparency-actions' })\n  transparencyActions: PrivacyRequestDemand.action[] = [];\n\n  @state() _restrictions: Restrictions = {};\n\n  @state() _message: string | undefined;\n\n  action: PrivacyRequestDemand.action =\n    PrivacyRequestDemand.action.TRANSPARENCY;\n\n  validateActionInput(): string[] | undefined {\n    return undefined;\n  }\n\n  validateOptionsInput(): string[] | undefined {\n    return undefined;\n  }\n\n  getFormTemplate(): TemplateResult<1 | 2> {\n    return html`\n      <p>${msg('I want to know:')}</p>\n      <bldn-all-checklist\n        .choices=${this.transparencyActions.map(action => ({\n          value: action,\n          display: TRANSPARENCY_ACTION_DESCRIPTIONS[action](),\n          checked:\n            this.demands.findIndex(demand => demand.action === action) !== -1,\n          allChoice: action === PrivacyRequestDemand.action.TRANSPARENCY,\n        }))}\n      ></bldn-all-checklist>\n    `;\n  }\n\n  getOptionsTemplate(): TemplateResult<1 | 2> {\n    return html`\n      <bldn-dropdown>\n        <span slot=\"heading\"><strong>${msg('Date Restriction')}</strong></span>\n        <bldn-date-restriction\n          start=${ifDefined(this.demands[0].restrictions?.date_range?.from)}\n          end=${ifDefined(this.demands[0].restrictions?.date_range?.to)}\n        ></bldn-date-restriction>\n      </bldn-dropdown>\n      <bldn-dropdown>\n        <span slot=\"heading\"\n          ><strong>${msg('Provenance Restriction')}</strong></span\n        >\n        <bldn-provenance-restriction\n          term=${ifDefined(this.demands[0].restrictions?.provenance?.term)}\n        ></bldn-provenance-restriction>\n      </bldn-dropdown>\n      <bldn-dropdown>\n        <span slot=\"heading\"\n          ><strong>${msg('Additional Message')}</strong></span\n        >\n        <bldn-additional-message\n          message=${ifDefined(this.demands[0].message)}\n        ></bldn-additional-message>\n      </bldn-dropdown>\n    `;\n  }\n\n  getDefaultDemands(): PrivacyRequestDemand[] {\n    return [\n      {\n        id: '',\n        action: PrivacyRequestDemand.action.TRANSPARENCY,\n        restrictions: {\n          provenance: {\n            term: ProvenanceRestriction.term._,\n          },\n          date_range: {},\n        },\n      },\n    ];\n  }\n\n  // Listener Functions\n\n  /**\n   * Add a new demand to this demand group for the selected transparency action\n   * @param e {CustomEvent} Event containing the transparency action to add\n   */\n  addTransparencyAction(e: Event) {\n    const { value } = (e as CustomEvent).detail;\n    const newDemand: PrivacyRequestDemand = {\n      id: '',\n      action: value,\n      restrictions: this._restrictions,\n    };\n    if (this._message) {\n      newDemand.message = this._message;\n    }\n    this.demands.push(newDemand);\n  }\n\n  /**\n   * Remove a demand from this demand group for the deselected transparency action\n   * @param e {CustomEvent} Event containing the transparency action to remove\n   */\n  removeTransparencyAction(e: Event) {\n    const { value } = (e as CustomEvent).detail;\n    const removeIndex = this.demands.findIndex(\n      demand => demand.action === value\n    );\n    if (removeIndex > -1) {\n      this.demands.splice(removeIndex, 1);\n    }\n  }\n\n  /**\n   * Update the date restriction start for this demand\n   * @param e {CustomEvent} Event containing the new start date\n   */\n  changeDateRestrictionStart(e: Event) {\n    e.stopPropagation();\n    const { date } = (e as CustomEvent).detail;\n    this._restrictions!.date_range!.from = date;\n\n    // Update the date restriction start of each demand\n    this.demands.forEach(demand => {\n      demand.restrictions!.date_range!.from = date;\n    });\n  }\n\n  /**\n   * Update the date restriction end for this demand\n   * @param e {CustomEvent} Event containing the new end date\n   */\n  changeDateRestrictionEnd(e: Event) {\n    e.stopPropagation();\n    const { date } = (e as CustomEvent).detail;\n    this._restrictions!.date_range!.to = date;\n\n    // Update the date restriction end of each demand\n    this.demands.forEach(demand => {\n      demand.restrictions!.date_range!.to = date;\n    });\n  }\n\n  /**\n   * Update the provenance restriction term for this demand\n   * @param e {CustomEvent} Event containing the new provenance restriction term\n   */\n  changeProvenanceRestrictionTerm(e: Event) {\n    e.stopPropagation();\n    const { term } = (e as CustomEvent).detail;\n    this._restrictions!.provenance!.term = term;\n\n    // Update the provenance restriction term of each demand\n    this.demands.forEach(demand => {\n      demand.restrictions!.provenance!.term = term;\n    });\n  }\n\n  /**\n   * Update the message for this demand\n   * @param e {CustomEvent} Event containing the data category string to add\n   */\n  changeMessage(e: Event) {\n    e.stopPropagation();\n    const { message } = (e as CustomEvent).detail;\n    this._message = message;\n\n    // Update message of each demand\n    this.demands.forEach(demand => {\n      demand.message = this._message;\n    });\n  }\n\n  /**\n   * Add listeners for elements of this ActionForm\n   */\n  connectedCallback(): void {\n    // eslint-disable-next-line wc/guard-super-call\n    super.connectedCallback();\n\n    // Data category listeners\n    this.addEventListener(\n      'bldn-all-checklist:choice-select',\n      this.addTransparencyAction\n    );\n    this.addEventListener(\n      'bldn-all-checklist:choice-deselect',\n      this.removeTransparencyAction\n    );\n\n    // Date restriction listeners\n    this.addEventListener(\n      'bldn-date-restriction:start-date-change',\n      this.changeDateRestrictionStart\n    );\n    this.addEventListener(\n      'bldn-date-restriction:end-date-change',\n      this.changeDateRestrictionEnd\n    );\n\n    // Provenance restriction listener\n    this.addEventListener(\n      'bldn-provenance-restriction:term-change',\n      this.changeProvenanceRestrictionTerm\n    );\n\n    // Message listener\n    this.addEventListener(\n      'bldn-additional-message:message-change',\n      this.changeMessage\n    );\n  }\n\n  /**\n   * Remove all listeners\n   */\n  disconnectedCallback(): void {\n    this.removeEventListener(\n      'bldn-all-checklist:choice-select',\n      this.addTransparencyAction\n    );\n    this.removeEventListener(\n      'bldn-all-checklist:choice-deselect',\n      this.removeTransparencyAction\n    );\n    this.removeEventListener(\n      'bldn-date-restriction:start-date-change',\n      this.changeDateRestrictionStart\n    );\n    this.removeEventListener(\n      'bldn-date-restriction:end-date-change',\n      this.changeDateRestrictionEnd\n    );\n    this.removeEventListener(\n      'bldn-provenance-restriction:term-change',\n      this.changeProvenanceRestrictionTerm\n    );\n    this.removeEventListener(\n      'bldn-additional-message:message-change',\n      this.changeMessage\n    );\n  }\n\n  /**\n   * Set the restrictions and message states initially\n   */\n  handleDemandsChange() {\n    if (this.demands.length > 0) {\n      if (this.demands[0].restrictions) {\n        this._restrictions = this.demands[0].restrictions;\n      }\n      if (this.demands[0].message) {\n        this._message = this.demands[0].message;\n      }\n    }\n  }\n\n  protected willUpdate(\n    _changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>\n  ): void {\n    if (_changedProperties.has('demands')) this.handleDemandsChange();\n  }\n\n  static styles = [\n    ActionForm.styles,\n    css`\n      :host {\n        text-align: left;\n        color: var(--bldn-transparency-form-font-color, var(--color-dark));\n      }\n\n      p {\n        margin: 2em 0em;\n      }\n\n      p + bldn-all-checklist {\n        margin-top: 1em;\n        padding-left: 1em;\n      }\n    `,\n  ];\n}\n"],"names":[],"mappings":"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"}