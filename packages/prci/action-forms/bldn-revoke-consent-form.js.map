{"version":3,"file":"bldn-revoke-consent-form.js","sources":["../../src/action-forms/bldn-revoke-consent-form.ts"],"sourcesContent":["/* eslint-disable no-param-reassign */\nimport {\n  ComputationAPI,\n  GivenConsentsPayload,\n  PrivacyRequestDemand,\n} from '@blindnet/core';\nimport { msg } from '@lit/localize';\nimport { css, html, TemplateResult } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { when } from 'lit/directives/when.js';\n\nimport { ActionForm } from './bldn-action-form.js';\nimport '../bldn-radio-list.js';\nimport '../bldn-checklist.js';\n\n/**\n * Action form for the REVOKE-CONSENT PRIV Action\n */\n@customElement('bldn-revoke-consent-form')\nexport class BldnRevokeConsentForm extends ActionForm {\n  @state() _consents: GivenConsentsPayload[] = [];\n\n  @state() _message: string | undefined;\n\n  @state() _showEach: boolean = false;\n\n  action: PrivacyRequestDemand.action =\n    PrivacyRequestDemand.action.REVOKE_CONSENT;\n\n  constructor() {\n    super();\n\n    if (ComputationAPI.getInstance().apiTokenSet()) {\n      ComputationAPI.getInstance()\n        .getUserConsents()\n        .then(consents => {\n          this._consents = consents;\n\n          // Set state based off demands passed in\n          if (this.demands.length === 1 && !this.demands[0].restrictions) {\n            // Default case, select all consent IDs and add a demand for each\n            this.demands = [];\n            this._consents.forEach(c => {\n              this.demands.push({\n                id: '',\n                action: PrivacyRequestDemand.action.REVOKE_CONSENT,\n                restrictions: {\n                  consent: {\n                    id: c.id,\n                  },\n                },\n                message: this._message,\n              });\n            });\n          } else {\n            // Otherwise show the list of consents\n            this._showEach = true;\n          }\n        });\n    } else {\n      // TODO: Set some error message here that is the same for all forms\n      // eslint-disable-next-line no-console\n      console.log('User must be authenticated for this demand type!');\n    }\n  }\n\n  validateActionInput(): string[] | undefined {\n    return undefined;\n  }\n\n  validateOptionsInput(): string[] | undefined {\n    return undefined;\n  }\n\n  getFormTemplate(): TemplateResult<1 | 2> {\n    return html`\n      <p>${msg('I want to:')}</p>\n      <bldn-radio-list\n        .choices=${[\n          {\n            value: 'all',\n            display: msg(html`Revoke <b>all</b> consents`),\n            checked: !this._showEach,\n          },\n          {\n            value: 'some',\n            display: msg(\n              html`Revoke <b>specific</b> consents (select those you wish to\n                <b>revoke</b>)`\n            ),\n            checked: this._showEach,\n          },\n        ]}\n        @bldn-radio-list:choice-change=${this.handleRevokeTypeChange}\n      ></bldn-radio-list>\n      ${when(\n        this._showEach,\n        () => html`\n          <bldn-checklist\n            .choices=${this._consents.map(c => ({\n              value: c.id,\n              display: html`${c.name} -\n                <i\n                  >${msg(\n                    html`Given on ${new Date(c.date).toLocaleString()}`\n                  )}</i\n                >`,\n              checked:\n                this.demands.findIndex(\n                  d => d.restrictions!.consent!.id === c.id\n                ) > -1,\n            }))}\n            @bldn-checklist:choice-select=${this.addConsent}\n            @bldn-checklist:choice-deselect=${this.removeConsent}\n          ></bldn-checklist>\n        `\n      )}\n    `;\n  }\n\n  getOptionsTemplate(): TemplateResult<1 | 2> {\n    return html`\n      <bldn-dropdown>\n        <span slot=\"heading\"\n          ><strong>${msg('Additional Message')}</strong></span\n        >\n        <bldn-additional-message\n          message=${ifDefined(\n            this.demands.length > 0 ? this.demands[0].message : undefined\n          )}\n        ></bldn-additional-message>\n      </bldn-dropdown>\n    `;\n  }\n\n  getDefaultDemands(): PrivacyRequestDemand[] {\n    return [\n      {\n        id: '',\n        action: PrivacyRequestDemand.action.REVOKE_CONSENT,\n      },\n    ];\n  }\n\n  // Listener Functions\n\n  /**\n   * Hide or show the consents list based on radio selection\n   * @param e Event with value of radio button clicked\n   */\n  handleRevokeTypeChange(e: Event) {\n    e.stopPropagation();\n    const { value } = (e as CustomEvent).detail;\n    this._showEach = value === 'some';\n    this.demands = [];\n    if (value === 'all') {\n      // Add a demand for each consent\n      this._consents.forEach(c => {\n        this.demands.push({\n          id: '',\n          action: PrivacyRequestDemand.action.REVOKE_CONSENT,\n          restrictions: {\n            consent: {\n              id: c.id,\n            },\n          },\n          message: this._message,\n        });\n      });\n    }\n  }\n\n  addConsent(e: Event) {\n    e.stopPropagation();\n    const { value } = (e as CustomEvent).detail;\n\n    // Add a new demand for this consent\n    this.demands.push({\n      id: '',\n      action: PrivacyRequestDemand.action.REVOKE_CONSENT,\n      restrictions: {\n        consent: {\n          id: value,\n        },\n      },\n      message: this._message,\n    });\n  }\n\n  removeConsent(e: Event) {\n    e.stopPropagation();\n    const { value } = (e as CustomEvent).detail;\n\n    // Remove the demand with this consent ID\n    const removeIndex = this.demands.findIndex(\n      d => d.restrictions!.consent!.id === value\n    );\n    if (removeIndex > -1) {\n      this.demands.splice(removeIndex, 1);\n    }\n  }\n\n  /**\n   * Update the message for this demand\n   * @param e {CustomEvent} Event containing the data category string to add\n   */\n  changeMessage(e: Event) {\n    e.stopPropagation();\n    const { message } = (e as CustomEvent).detail;\n    this._message = message;\n\n    // Update message of each demand\n    this.demands.forEach(demand => {\n      demand.message = this._message;\n    });\n  }\n\n  /**\n   * Add listeners for elements of this ActionForm\n   */\n  connectedCallback(): void {\n    // eslint-disable-next-line wc/guard-super-call\n    super.connectedCallback();\n\n    // Message listener\n    this.addEventListener(\n      'bldn-additional-message:message-change',\n      this.changeMessage\n    );\n  }\n\n  /**\n   * Remove all listeners\n   */\n  disconnectedCallback(): void {\n    this.removeEventListener(\n      'bldn-additional-message:message-change',\n      this.changeMessage\n    );\n  }\n\n  static styles = [\n    ActionForm.styles,\n    css`\n      :host {\n        text-align: left;\n        color: var(--bldn-revoke-consent-form-font-color, var(--color-dark));\n      }\n\n      bldn-checklist {\n        margin-left: 1.5em;\n        /* padding-bottom: 1em; */\n        margin-bottom: 1em;\n      }\n    `,\n  ];\n}\n"],"names":[],"mappings":";;;;;;;;;;;AAgBA;;AAEG;AAEH,IAAa,qBAAqB,GAAlC,MAAa,qBAAsB,SAAQ,UAAU,CAAA;AAUnD,IAAA,WAAA,GAAA;AACE,QAAA,KAAK,EAAE,CAAC;QAVD,IAAS,CAAA,SAAA,GAA2B,EAAE,CAAC;QAIvC,IAAS,CAAA,SAAA,GAAY,KAAK,CAAC;AAEpC,QAAA,IAAA,CAAA,MAAM,GACJ,oBAAoB,CAAC,MAAM,CAAC,cAAc,CAAC;AAK3C,QAAA,IAAI,cAAc,CAAC,WAAW,EAAE,CAAC,WAAW,EAAE,EAAE;YAC9C,cAAc,CAAC,WAAW,EAAE;AACzB,iBAAA,eAAe,EAAE;iBACjB,IAAI,CAAC,QAAQ,IAAG;AACf,gBAAA,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;;AAG1B,gBAAA,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,YAAY,EAAE;;AAE9D,oBAAA,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;AAClB,oBAAA,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,IAAG;AACzB,wBAAA,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;AAChB,4BAAA,EAAE,EAAE,EAAE;AACN,4BAAA,MAAM,EAAE,oBAAoB,CAAC,MAAM,CAAC,cAAc;AAClD,4BAAA,YAAY,EAAE;AACZ,gCAAA,OAAO,EAAE;oCACP,EAAE,EAAE,CAAC,CAAC,EAAE;AACT,iCAAA;AACF,6BAAA;4BACD,OAAO,EAAE,IAAI,CAAC,QAAQ;AACvB,yBAAA,CAAC,CAAC;AACL,qBAAC,CAAC,CAAC;AACJ,iBAAA;AAAM,qBAAA;;AAEL,oBAAA,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;AACvB,iBAAA;AACH,aAAC,CAAC,CAAC;AACN,SAAA;AAAM,aAAA;;;AAGL,YAAA,OAAO,CAAC,GAAG,CAAC,kDAAkD,CAAC,CAAC;AACjE,SAAA;KACF;IAED,mBAAmB,GAAA;AACjB,QAAA,OAAO,SAAS,CAAC;KAClB;IAED,oBAAoB,GAAA;AAClB,QAAA,OAAO,SAAS,CAAC;KAClB;IAED,eAAe,GAAA;AACb,QAAA,OAAO,IAAI,CAAA,CAAA;WACJ,GAAG,CAAC,YAAY,CAAC,CAAA;;AAET,iBAAA,EAAA;AACT,YAAA;AACE,gBAAA,KAAK,EAAE,KAAK;AACZ,gBAAA,OAAO,EAAE,GAAG,CAAC,IAAI,CAAA,4BAA4B,CAAC;AAC9C,gBAAA,OAAO,EAAE,CAAC,IAAI,CAAC,SAAS;AACzB,aAAA;AACD,YAAA;AACE,gBAAA,KAAK,EAAE,MAAM;AACb,gBAAA,OAAO,EAAE,GAAG,CACV,IAAI,CAAA,CAAA;+BACa,CAClB;gBACD,OAAO,EAAE,IAAI,CAAC,SAAS;AACxB,aAAA;AACF,SAAA,CAAA;AACgC,uCAAA,EAAA,IAAI,CAAC,sBAAsB,CAAA;;QAE5D,IAAI,CACJ,IAAI,CAAC,SAAS,EACd,MAAM,IAAI,CAAA,CAAA;;uBAEK,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,KAAK;YAClC,KAAK,EAAE,CAAC,CAAC,EAAE;AACX,YAAA,OAAO,EAAE,IAAI,CAAA,CAAG,EAAA,CAAC,CAAC,IAAI,CAAA;;AAEf,mBAAA,EAAA,GAAG,CACJ,IAAI,CAAA,CAAA,SAAA,EAAY,IAAI,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,cAAc,EAAE,EAAE,CACpD,CAAA;AACD,iBAAA,CAAA;YACJ,OAAO,EACL,IAAI,CAAC,OAAO,CAAC,SAAS,CACpB,CAAC,IAAI,CAAC,CAAC,YAAa,CAAC,OAAQ,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,CAC1C,GAAG,CAAC,CAAC;AACT,SAAA,CAAC,CAAC,CAAA;AAC6B,0CAAA,EAAA,IAAI,CAAC,UAAU,CAAA;AACb,4CAAA,EAAA,IAAI,CAAC,aAAa,CAAA;;SAEvD,CACF,CAAA;KACF,CAAC;KACH;IAED,kBAAkB,GAAA;AAChB,QAAA,OAAO,IAAI,CAAA,CAAA;;;qBAGM,GAAG,CAAC,oBAAoB,CAAC,CAAA;;;oBAG1B,SAAS,CACjB,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,GAAG,SAAS,CAC9D,CAAA;;;KAGN,CAAC;KACH;IAED,iBAAiB,GAAA;QACf,OAAO;AACL,YAAA;AACE,gBAAA,EAAE,EAAE,EAAE;AACN,gBAAA,MAAM,EAAE,oBAAoB,CAAC,MAAM,CAAC,cAAc;AACnD,aAAA;SACF,CAAC;KACH;;AAID;;;AAGG;AACH,IAAA,sBAAsB,CAAC,CAAQ,EAAA;QAC7B,CAAC,CAAC,eAAe,EAAE,CAAC;AACpB,QAAA,MAAM,EAAE,KAAK,EAAE,GAAI,CAAiB,CAAC,MAAM,CAAC;AAC5C,QAAA,IAAI,CAAC,SAAS,GAAG,KAAK,KAAK,MAAM,CAAC;AAClC,QAAA,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;QAClB,IAAI,KAAK,KAAK,KAAK,EAAE;;AAEnB,YAAA,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,IAAG;AACzB,gBAAA,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;AAChB,oBAAA,EAAE,EAAE,EAAE;AACN,oBAAA,MAAM,EAAE,oBAAoB,CAAC,MAAM,CAAC,cAAc;AAClD,oBAAA,YAAY,EAAE;AACZ,wBAAA,OAAO,EAAE;4BACP,EAAE,EAAE,CAAC,CAAC,EAAE;AACT,yBAAA;AACF,qBAAA;oBACD,OAAO,EAAE,IAAI,CAAC,QAAQ;AACvB,iBAAA,CAAC,CAAC;AACL,aAAC,CAAC,CAAC;AACJ,SAAA;KACF;AAED,IAAA,UAAU,CAAC,CAAQ,EAAA;QACjB,CAAC,CAAC,eAAe,EAAE,CAAC;AACpB,QAAA,MAAM,EAAE,KAAK,EAAE,GAAI,CAAiB,CAAC,MAAM,CAAC;;AAG5C,QAAA,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;AAChB,YAAA,EAAE,EAAE,EAAE;AACN,YAAA,MAAM,EAAE,oBAAoB,CAAC,MAAM,CAAC,cAAc;AAClD,YAAA,YAAY,EAAE;AACZ,gBAAA,OAAO,EAAE;AACP,oBAAA,EAAE,EAAE,KAAK;AACV,iBAAA;AACF,aAAA;YACD,OAAO,EAAE,IAAI,CAAC,QAAQ;AACvB,SAAA,CAAC,CAAC;KACJ;AAED,IAAA,aAAa,CAAC,CAAQ,EAAA;QACpB,CAAC,CAAC,eAAe,EAAE,CAAC;AACpB,QAAA,MAAM,EAAE,KAAK,EAAE,GAAI,CAAiB,CAAC,MAAM,CAAC;;QAG5C,MAAM,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,CACxC,CAAC,IAAI,CAAC,CAAC,YAAa,CAAC,OAAQ,CAAC,EAAE,KAAK,KAAK,CAC3C,CAAC;AACF,QAAA,IAAI,WAAW,GAAG,CAAC,CAAC,EAAE;YACpB,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;AACrC,SAAA;KACF;AAED;;;AAGG;AACH,IAAA,aAAa,CAAC,CAAQ,EAAA;QACpB,CAAC,CAAC,eAAe,EAAE,CAAC;AACpB,QAAA,MAAM,EAAE,OAAO,EAAE,GAAI,CAAiB,CAAC,MAAM,CAAC;AAC9C,QAAA,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;;AAGxB,QAAA,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,IAAG;AAC5B,YAAA,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC;AACjC,SAAC,CAAC,CAAC;KACJ;AAED;;AAEG;IACH,iBAAiB,GAAA;;QAEf,KAAK,CAAC,iBAAiB,EAAE,CAAC;;QAG1B,IAAI,CAAC,gBAAgB,CACnB,wCAAwC,EACxC,IAAI,CAAC,aAAa,CACnB,CAAC;KACH;AAED;;AAEG;IACH,oBAAoB,GAAA;QAClB,IAAI,CAAC,mBAAmB,CACtB,wCAAwC,EACxC,IAAI,CAAC,aAAa,CACnB,CAAC;KACH;EAiBF;AAfQ,qBAAA,CAAA,MAAM,GAAG;AACd,IAAA,UAAU,CAAC,MAAM;AACjB,IAAA,GAAG,CAAA,CAAA;;;;;;;;;;;AAWF,IAAA,CAAA;CACF,CAAC;AA3OO,UAAA,CAAA;AAAR,IAAA,KAAK,EAAE;AAAwC,CAAA,EAAA,qBAAA,CAAA,SAAA,EAAA,WAAA,EAAA,KAAA,CAAA,CAAA,CAAA;AAEvC,UAAA,CAAA;AAAR,IAAA,KAAK,EAAE;AAA8B,CAAA,EAAA,qBAAA,CAAA,SAAA,EAAA,UAAA,EAAA,KAAA,CAAA,CAAA,CAAA;AAE7B,UAAA,CAAA;AAAR,IAAA,KAAK,EAAE;AAA4B,CAAA,EAAA,qBAAA,CAAA,SAAA,EAAA,WAAA,EAAA,KAAA,CAAA,CAAA,CAAA;AALzB,qBAAqB,GAAA,UAAA,CAAA;IADjC,aAAa,CAAC,0BAA0B,CAAC;AAC7B,CAAA,EAAA,qBAAqB,CA6OjC;;;;"}