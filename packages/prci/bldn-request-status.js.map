{"version":3,"file":"bldn-request-status.js","sources":["../src/bldn-request-status.ts"],"sourcesContent":["/* eslint-disable camelcase */\nimport {\n  CoreConfigurationMixin,\n  PrivacyResponsePayload,\n  ComputationAPI,\n  LegalBase,\n  PrivacyScopeTriple,\n  RetentionPolicy,\n  Provenance,\n} from '@blindnet/core';\nimport { msg } from '@lit/localize';\nimport { css, html, LitElement, PropertyValueMap } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { map } from 'lit/directives/map.js';\nimport { when } from 'lit/directives/when.js';\n\nimport './bldn-dropdown.js';\nimport {\n  ACTION_DESCRIPTIONS,\n  ACTION_TITLES,\n  AFTER_TITLES,\n  DEMAND_STATUS_DESCRIPTIONS,\n  POLICY_TYPE_TITLES,\n} from './utils/dictionary.js';\n\nconst linkSvg = new URL(\n  './assets/icons/akar-icons_link-chain.svg',\n  import.meta.url\n).href;\n\nconst downloadSvg = new URL(\n  './assets/icons/akar-icons_download.svg',\n  import.meta.url\n).href;\n\nconst cancelSvg = new URL('./assets/icons/ic_round-cancel.svg', import.meta.url)\n  .href;\n\nconst refreshSvg = new URL(\n  './assets/icons/heroicons-solid_refresh.svg',\n  import.meta.url\n).href;\n\n/**\n * Get a user friendly string for a retention policy\n * @param dataCategory Data category the policy pertains to\n * @param policy Type of the policy\n * @param duration String quantifying the duration, e.g. 10 months\n * @param after Point after which the data is kept\n * @returns String combining the provided information to represent a retention policy\n */\nexport function getRetentionPolicyString(\n  dataCategory: string,\n  policyType: RetentionPolicy.policy_type,\n  duration: string,\n  after: RetentionPolicy.after\n) {\n  // FIXME: For our first demo, we assume duration is in months\n  return html`<i>${dataCategory.toLocaleUpperCase()}</i> data is kept\n    <i>${POLICY_TYPE_TITLES[policyType]().toLocaleUpperCase()}</i>\n    <i>${duration}</i> months after\n    <i>${AFTER_TITLES[after]().toLocaleUpperCase()}</i>`;\n}\n\n/**\n * Get a link to the status page for the request denoted by requestId\n * @param requestId ID of the privacy request\n * @returns\n */\nexport function getRequestLink(requestId: string): URL {\n  const url = new URL(document.URL);\n  url.searchParams.set('requestId', requestId);\n  return url;\n}\n\n@customElement('bldn-request-status')\nexport class BldnRequestStatus extends CoreConfigurationMixin(LitElement) {\n  @property({ type: String }) requestId: string | undefined;\n\n  @state() _requestDetails: PrivacyResponsePayload[] = [];\n\n  @state() _error: boolean = false;\n\n  getRequestDetails() {\n    ComputationAPI.getInstance()\n      .getRequest(this.requestId!)\n      .then(requestDetails => {\n        this._requestDetails = requestDetails;\n        this._error = false;\n      })\n      .catch(e => {\n        // eslint-disable-next-line no-console\n        console.log(e);\n        this._error = true;\n      });\n  }\n\n  handleCopyLinkClick() {\n    navigator.clipboard.writeText(getRequestLink(this.requestId!).toString());\n  }\n\n  handleDownloadClick(demand: PrivacyResponsePayload) {\n    window.location.href = demand.data!;\n  }\n\n  handleCancelClick(demand: PrivacyResponsePayload) {\n    ComputationAPI.getInstance()\n      .cancelDemand(demand.demand_id)\n      .then(() => {\n        // Refetch request status after cancelling\n        this.getRequestDetails();\n      })\n      .catch(e => {\n        // eslint-disable-next-line no-console\n        console.log(e);\n      });\n  }\n\n  handleRefreshClick() {\n    this.getRequestDetails();\n  }\n\n  protected willUpdate(\n    _changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>\n  ): void {\n    if (_changedProperties.has('apiToken') && this.apiToken && this.requestId) {\n      this.getRequestDetails();\n    }\n\n    if (_changedProperties.has('requestId')) {\n      if (this.requestId && ComputationAPI.getInstance().apiTokenSet()) {\n        this.getRequestDetails();\n      } else if (this.requestId) {\n        // Try waiting 2 seconds incase there is a delay in setting the api token,\n        // such as in our demo\n        setTimeout(() => {\n          if (ComputationAPI.getInstance().apiTokenSet()) {\n            this.getRequestDetails();\n          }\n        }, 2000);\n      }\n    }\n\n    if (\n      _changedProperties.has('requestId') &&\n      this.requestId &&\n      ComputationAPI.getInstance().apiTokenSet()\n    )\n      this.getRequestDetails();\n  }\n\n  render() {\n    return html`\n      <bldn-dropdown class=\"main-section\" mode=\"major\" open>\n        <span slot=\"heading\" id='summary-heading'><b>${msg(\n          html`Request Summary`\n        )}</b>\n          <bldn-button mode='link-icon' underline-mode='none' @bldn-button:click=${\n            this.handleCopyLinkClick\n          }>\n            <span class='request-action'><b>${msg('Copy Link')}</b></span>\n            <img src=${linkSvg} alt='copy link to request status page'></img>\n          </bldn-button>\n          <bldn-button id='refresh-request' mode='link-icon' underline-mode='none' @bldn-button:click=${\n            this.handleRefreshClick\n          }>\n            <span class='request-action'><b>${msg('Refresh')}</b></span>\n            <img src=${refreshSvg} alt='refresh this request'></img>\n          </bldn-button>\n        </span>\n        ${when(\n          this._requestDetails.length > 0,\n          () => html`\n            ${this._requestDetails.map(demand => {\n              const classes = {\n                granted:\n                  demand.status === PrivacyResponsePayload.status.GRANTED,\n                denied: demand.status === PrivacyResponsePayload.status.DENIED,\n                partial:\n                  demand.status ===\n                    PrivacyResponsePayload.status.PARTIALLY_GRANTED ||\n                  demand.status === PrivacyResponsePayload.status.UNDER_REVIEW,\n                canceled:\n                  demand.status === PrivacyResponsePayload.status.CANCELED,\n              };\n              return html`\n                <bldn-dropdown>\n                  <span slot=\"heading\"\n                    ><strong\n                      >${msg(\n                        html`${ACTION_TITLES[demand.requested_action]()} Demand`\n                      )}&nbsp;&nbsp;&nbsp;<span class=${classMap(classes)}\n                        >${DEMAND_STATUS_DESCRIPTIONS[demand.status]()}</span\n                      ></strong\n                    ></span\n                  >\n                  ${this.getStatusTemplate(demand)}\n                </bldn-dropdown>\n                ${map(demand.includes, subDemand => {\n                  const subClasses = {\n                    granted:\n                      subDemand.status ===\n                      PrivacyResponsePayload.status.GRANTED,\n                    denied:\n                      subDemand.status === PrivacyResponsePayload.status.DENIED,\n                    partial:\n                      subDemand.status ===\n                        PrivacyResponsePayload.status.PARTIALLY_GRANTED ||\n                      subDemand.status ===\n                        PrivacyResponsePayload.status.UNDER_REVIEW,\n                    canceled:\n                      subDemand.status ===\n                      PrivacyResponsePayload.status.CANCELED,\n                  };\n                  return html`\n                    <bldn-dropdown>\n                      <span slot=\"heading\"\n                        ><strong\n                          >${msg(\n                            html`${ACTION_TITLES[subDemand.requested_action]()}\n                            Demand`\n                          )}&nbsp;&nbsp;&nbsp;<span\n                            class=${classMap(subClasses)}\n                            >${DEMAND_STATUS_DESCRIPTIONS[\n                              subDemand.status\n                            ]()}</span\n                          ></strong\n                        ></span\n                      >\n                      ${this.getStatusTemplate(subDemand)}\n                    </bldn-dropdown>\n                  `;\n                })}\n              `;\n            })}\n          `,\n          () => html`\n            <p id=\"loading-message\">\n              ${when(\n                this._error,\n                () => html`\n                  ${msg('Error getting request details. Please refresh later.')}\n                `,\n                () => html` ${msg('Loading request details...')} `\n              )}\n            </p>\n          `\n        )}\n      </bldn-dropdown>\n    `;\n  }\n\n  getStatusTemplate(demand: PrivacyResponsePayload) {\n    return html`\n      <p>\n        <b>${msg('Requested:')}</b> ${ACTION_DESCRIPTIONS[\n          demand.requested_action\n        ]()}\n      </p>\n\n      ${choose(demand.status, [\n        [\n          PrivacyResponsePayload.status.GRANTED,\n          () => this.getGrantedResponseTemplate(demand),\n        ],\n        [\n          PrivacyResponsePayload.status.DENIED,\n          () => html`\n            <p>\n              ${msg('This demand has been denied. Reason: ')}<i\n                >${demand.message}</i\n              >\n            </p>\n          `,\n        ],\n        [\n          PrivacyResponsePayload.status.PARTIALLY_GRANTED,\n          () => html`<p>${msg('This demand has been partially granted.')}</p>`,\n        ],\n        [\n          PrivacyResponsePayload.status.UNDER_REVIEW,\n          () => html`\n            <p>\n              ${msg('This demand is still under review.')}\n              <bldn-button\n                mode=\"link-icon\"\n                underline-mode='none'\n                @bldn-button:click=${() => this.handleCancelClick(demand)}\n              >\n                <span class=\"cancel-demand\">${msg('Cancel Demand')}</span>\n                <img src=${cancelSvg} alt='cancel demand'></img>\n              </bldn-button>\n            </p>\n          `,\n        ],\n        [\n          PrivacyResponsePayload.status.CANCELED,\n          () => html`<p>${msg('This demand has been cancelled.')}</p>`,\n        ],\n      ])}\n    `;\n  }\n\n  // NOTE: For now, we assume demand.data is a JSON file\n  getGrantedResponseTemplate(demand: PrivacyResponsePayload) {\n    return html`\n      ${choose(demand.requested_action, [\n        [\n          PrivacyResponsePayload.requested_action.ACCESS,\n          () => html`\n            ${when(\n              demand.data,\n              () => html`\n                <bldn-button mode='link-icon' @bldn-button:click=${() =>\n                  this.handleDownloadClick(demand)}>\n                  <img src=${downloadSvg} alt='download your data'></img>\n                  <span>${msg('Download your data.')}</span>\n                </bldn-button>\n              `,\n              () =>\n                html`<p>\n                  ${msg(\n                    'Obtaining data, please wait and refresh the page later.'\n                  )}\n                </p>`\n            )}\n          `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.DELETE,\n          () => html` <p>${msg('Your delete demand has been granted.')}</p> `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.MODIFY,\n          () => html` <p>${msg('Your modify demand has been granted.')}</p> `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.OBJECT,\n          () => html` <p>${msg('Your object demand has been granted')}</p> `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.OTHER,\n          () => html` <p>${msg('Your demand has been granted.')}</p> `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.PORTABILITY,\n          () => html`\n            <p>${msg('Your portability demand has been granted.')}</p>\n          `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.RESTRICT,\n          () => html` <p>${msg('Your restrict demand has been granted.')}</p> `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.REVOKE_CONSENT,\n          () => html`\n            <p>${msg('Your revoke consent demand has been granted.')}</p>\n          `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.TRANSPARENCY,\n          () => html`\n            <p>\n              ${msg(\n                'Your transparency demand has been granted and split into multiple demands below.'\n              )}\n            </p>\n          `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.TRANSPARENCY_DATA_CATEGORIES,\n          () => html`\n            ${map(demand.answer as Array<string>, dc => html` ${dc}<br /> `)}\n          `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.TRANSPARENCY_DPO,\n          () => html` <p>${demand.answer}</p> `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.TRANSPARENCY_KNOWN,\n          () => html` <p>${demand.answer}</p> `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.TRANSPARENCY_LEGAL_BASES,\n          () => html`\n            <p>\n              ${map(demand.answer as Array<LegalBase>, lb =>\n                msg(html`\n                  Type: ${lb.lb_type}<br />\n                  Name: ${lb.name}<br />\n                  Description: ${lb.description}<br /><br />\n                `)\n              )}\n            </p>\n          `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.TRANSPARENCY_ORGANIZATION,\n          () => html` <p>${demand.answer}</p> `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.TRANSPARENCY_POLICY,\n          () => html` <p>${demand.answer}</p> `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action\n            .TRANSPARENCY_PROCESSING_CATEGORIES,\n          () => html`\n            <p>\n              ${map(\n                demand.answer as Array<PrivacyScopeTriple.processing_category>,\n                pc => html` ${pc}<br /> `\n              )}\n            </p>\n          `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.TRANSPARENCY_PROVENANCE,\n          () => {\n            const provs: [string, [Provenance]][] = Object.entries(\n              demand.answer\n            );\n            return html`\n              <p>\n                ${map(\n                  provs,\n                  dc => html`\n                    ${map(\n                      dc[1],\n                      prov => html`\n                        ${msg(\n                          html`<b>${dc[0]} Data:</b> Source\n                            <i>${prov.provenance}</i> of the\n                            <i>${prov.system}</i> system.<br />`\n                        )}\n                      `\n                    )}\n                  `\n                )}\n              </p>\n            `;\n          },\n        ],\n        [\n          PrivacyResponsePayload.requested_action.TRANSPARENCY_PURPOSE,\n          () => html`\n            <p>\n              ${map(\n                demand.answer as Array<PrivacyScopeTriple.purpose>,\n                purpose => html` ${purpose}<br /> `\n              )}\n            </p>\n          `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.TRANSPARENCY_RETENTION,\n          () => {\n            const answer = demand.answer as {\n              NAME: RetentionPolicy[];\n            };\n            return html`\n              <p>\n                ${map(\n                  answer.NAME,\n                  rp =>\n                    html`<p>\n                      ${getRetentionPolicyString(\n                        'Data',\n                        rp.policy_type,\n                        rp.duration,\n                        rp.after\n                      )}\n                    </p>`\n                )}\n              </p>\n            `;\n          },\n        ],\n        [\n          PrivacyResponsePayload.requested_action.TRANSPARENCY_WHERE,\n          () => html`\n            <p>\n              ${map(\n                demand.answer as Array<string>,\n                where => html` ${where}<br /> `\n              )}\n            </p>\n          `,\n        ],\n        [\n          PrivacyResponsePayload.requested_action.TRANSPARENCY_WHO,\n          () => html`\n            <p>\n              ${map(\n                demand.answer as Array<string>,\n                who => html` ${who}<br /> `\n              )}\n            </p>\n          `,\n        ],\n      ])}\n    `;\n  }\n\n  static styles = css`\n    :host {\n      display: block;\n      text-align: left;\n      color: var(--bldn-request-status-font-color, var(--color-dark));\n    }\n\n    bldn-dropdown.main-section {\n      border: 2px solid\n        var(--bldn-action-form-section-border-color, var(--color-dark));\n      border-radius: 20px;\n      padding: 2.5em;\n      /* FIXME: This makes the border expansion jump weird */\n      /* transition: 0.3s ease-out; */\n    }\n\n    bldn-dropdown.main-section[open] {\n      padding: 2.5em 2.5em 0.5em 2.5em;\n    }\n\n    /* Font for main sections: Demand Details and Other Options */\n    bldn-dropdown.main-section > span {\n      font-size: var(\n        --bldn-action-form-section-heading-font-size,\n        var(--font-size-medium)\n      );\n      color: var(\n        --bldn-action-form-section-heading-font-color,\n        var(--color-dark)\n      );\n    }\n\n    /* Font for other options headings */\n    bldn-dropdown bldn-dropdown span {\n      font-size: var(--font-size-small);\n      color: var(\n        --bldn-action-form-subsection-heading-font-color,\n        var(--color-dark)\n      );\n    }\n\n    bldn-dropdown bldn-dropdown > span[slot='heading'] {\n      padding-left: 0;\n    }\n\n    bldn-dropdown bldn-dropdown > * {\n      padding-left: 1.25em;\n    }\n\n    /* Divider between other options dropdowns */\n    bldn-dropdown {\n      border-bottom: 2px solid\n        var(--bldn-action-form-subsection-divider-color, var(--color-lightest));\n    }\n\n    /* Last dropdown in other options should have no border */\n    bldn-dropdown bldn-dropdown:last-child {\n      border-bottom: none;\n    }\n\n    #summary-heading {\n      display: flex;\n      gap: 1em;\n    }\n\n    #loading-message {\n      margin: 0.8em 0em;\n    }\n\n    .request-action {\n      color: var(--color-medium);\n    }\n\n    .granted {\n      color: var(--color-positive);\n    }\n\n    .denied {\n      color: var(--color-negative);\n    }\n\n    .partial {\n      color: var(--color-warning);\n    }\n\n    .canceled {\n      color: var(--color-light);\n    }\n\n    .cancel-demand {\n      color: var(--color-negative);\n    }\n  `;\n}\n"],"names":[],"mappings":"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"}