{"version":3,"file":"bldn-request-builder.js","sources":["../src/bldn-request-builder.ts"],"sourcesContent":["import { css, html, LitElement, PropertyValueMap, TemplateResult } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport {\n  ComputationAPI,\n  CoreConfigurationMixin,\n  CreatePrivacyRequestPayload,\n  PrivacyRequestDemand,\n  PrivacyScopeRestriction,\n} from '@blindnet/core';\nimport { choose } from 'lit/directives/choose.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\n\nimport './bldn-tile-menu.js';\nimport './bldn-request-review.js';\nimport './action-forms/bldn-access-form.js';\nimport './action-forms/bldn-delete-form.js';\nimport './action-forms/bldn-object-form.js';\nimport './action-forms/bldn-restrict-form.js';\nimport './action-forms/bldn-revoke-consent-form.js';\nimport './action-forms/bldn-transparency-form.js';\nimport './action-forms/bldn-other-form.js';\nimport { localized } from '@lit/localize';\nimport { ACTION_DESCRIPTIONS, ACTION_TITLES } from './utils/dictionary.js';\n\n/**\n * Decode a base64url string\n * @param input String to decode\n * @returns Decoded string\n */\nfunction decode(input: string) {\n  let output = (input || '').replace(/-/g, '+').replace(/_/g, '/');\n\n  switch (output.length % 4) {\n    case 0:\n      break;\n    case 2:\n      output += '==';\n      break;\n    case 3:\n      output += '=';\n      break;\n    default:\n      throw Error('Illegal base64url string!');\n  }\n  return atob(output);\n}\n\nenum DefaultDataCategories {\n  'ALL' = '*',\n  'AFFILIATION' = 'AFFILIATION',\n  'BEHAVIOR' = 'BEHAVIOR',\n  'BIOMETRIC' = 'BIOMETRIC',\n  'CONTACT' = 'CONTACT',\n  'DEMOGRAPHIC' = 'DEMOGRAPHIC',\n  'DEVICE' = 'DEVICE',\n  'FINANCIAL' = 'FINANCIAL',\n  'GENETIC' = 'GENETIC',\n  'HEALTH' = 'HEALTH',\n  'IMAGE' = 'IMAGE',\n  'LOCATION' = 'LOCATION',\n  'NAME' = 'NAME',\n  'PROFILING' = 'PROFILING',\n  'RELATIONSHIPS' = 'RELATIONSHIPS',\n  'UID' = 'UID',\n  'OTHER-DATA' = 'OTHER-DATA',\n}\n\nenum RequestBuilderUIState {\n  menu,\n  edit,\n  review,\n}\n\n@localized()\n@customElement('bldn-request-builder')\nexport class BldnRequestBuilder extends CoreConfigurationMixin(LitElement) {\n  /** @prop */\n  @property({ type: Array }) actions: PrivacyRequestDemand.action[] =\n    Object.values(PrivacyRequestDemand.action);\n\n  /** @prop */\n  @property({ type: Array, attribute: 'data-categories' })\n  dataCategories: string[] = [];\n\n  @state() _uiState: RequestBuilderUIState = RequestBuilderUIState.menu;\n\n  @state() _action: undefined | PrivacyRequestDemand.action;\n\n  @state() _demandGroupIndex: undefined | number;\n\n  @state() _demandGroups: PrivacyRequestDemand[][] = [];\n\n  @state() _allowedActions: PrivacyRequestDemand.action[] = Object.values(\n    PrivacyRequestDemand.action\n  );\n\n  @state() _allowedDataCategories: string[] = [];\n\n  /**\n   * Factory method to get the action form for a specific action\n   * @param action Action of the form to return\n   * @returns Template with an action form\n   */\n  private getActionForm(\n    action: PrivacyRequestDemand.action\n  ): TemplateResult<1 | 2> {\n    return html`\n      ${choose(action, [\n        [\n          PrivacyRequestDemand.action.ACCESS,\n          () => html`\n            <bldn-access-form\n              data-categories=${JSON.stringify(this._allowedDataCategories)}\n              .demands=${this._demandGroupIndex !== undefined\n                ? this._demandGroups[this._demandGroupIndex]\n                : ifDefined(undefined)}\n              demand-group-index=${ifDefined(this._demandGroupIndex)}\n            ></bldn-access-form>\n          `,\n        ],\n        [\n          PrivacyRequestDemand.action.DELETE,\n          () => html`\n            <bldn-delete-form\n              data-categories=${JSON.stringify(this._allowedDataCategories)}\n              .demands=${this._demandGroupIndex !== undefined\n                ? this._demandGroups[this._demandGroupIndex]\n                : ifDefined(undefined)}\n              demand-group-index=${ifDefined(this._demandGroupIndex)}\n            ></bldn-delete-form>\n          `,\n        ],\n        [\n          PrivacyRequestDemand.action.MODIFY,\n          () => html`\n            <bldn-other-form\n              data-categories=${JSON.stringify(this._allowedDataCategories)}\n              .demands=${this._demandGroupIndex !== undefined\n                ? this._demandGroups[this._demandGroupIndex]\n                : ifDefined(undefined)}\n              demand-group-index=${ifDefined(this._demandGroupIndex)}\n            ></bldn-other-form>\n          `,\n        ],\n        [\n          PrivacyRequestDemand.action.OBJECT,\n          () => html`\n            <bldn-object-form\n              data-categories=${JSON.stringify(this._allowedDataCategories)}\n              processing-categories=${JSON.stringify(\n                Object.values(PrivacyScopeRestriction.pc)\n              )}\n              purposes=${JSON.stringify(\n                Object.values(PrivacyScopeRestriction.pp)\n              )}\n              .demands=${this._demandGroupIndex !== undefined\n                ? this._demandGroups[this._demandGroupIndex]\n                : ifDefined(undefined)}\n              demand-group-index=${ifDefined(this._demandGroupIndex)}\n            ></bldn-object-form>\n          `,\n        ],\n        [\n          PrivacyRequestDemand.action.PORTABILITY,\n          () => html`\n            <bldn-other-form\n              data-categories=${JSON.stringify(this._allowedDataCategories)}\n              .demands=${this._demandGroupIndex !== undefined\n                ? this._demandGroups[this._demandGroupIndex]\n                : ifDefined(undefined)}\n              demand-group-index=${ifDefined(this._demandGroupIndex)}\n            ></bldn-other-form>\n          `,\n        ],\n        [\n          PrivacyRequestDemand.action.RESTRICT,\n          () => html`\n            <bldn-restrict-form\n              data-categories=${JSON.stringify(this._allowedDataCategories)}\n              processing-categories=${JSON.stringify(\n                Object.values(PrivacyScopeRestriction.pc)\n              )}\n              purposes=${JSON.stringify(\n                Object.values(PrivacyScopeRestriction.pp)\n              )}\n              .demands=${this._demandGroupIndex !== undefined\n                ? this._demandGroups[this._demandGroupIndex]\n                : ifDefined(undefined)}\n              demand-group-index=${ifDefined(this._demandGroupIndex)}\n            ></bldn-restrict-form>\n          `,\n        ],\n        [\n          PrivacyRequestDemand.action.TRANSPARENCY,\n          () => html`\n            <bldn-transparency-form\n              .transparencyActions=${this._allowedActions.filter(a =>\n                a.includes('TRANSPARENCY')\n              )}\n              .demands=${this._demandGroupIndex !== undefined\n                ? this._demandGroups[this._demandGroupIndex]\n                : ifDefined(undefined)}\n              demand-group-index=${ifDefined(this._demandGroupIndex)}\n            ></bldn-transparency-form>\n          `,\n        ],\n        [\n          PrivacyRequestDemand.action.REVOKE_CONSENT,\n          () => html`\n            <bldn-revoke-consent-form\n              data-categories=${JSON.stringify(this._allowedDataCategories)}\n              .demands=${this._demandGroupIndex !== undefined\n                ? this._demandGroups[this._demandGroupIndex]\n                : ifDefined(undefined)}\n              demand-group-index=${ifDefined(this._demandGroupIndex)}\n            ></bldn-revoke-consent-form>\n          `,\n        ],\n        [\n          PrivacyRequestDemand.action.OTHER,\n          () => html`\n            <bldn-other-form\n              data-categories=${JSON.stringify(this._allowedDataCategories)}\n              .demands=${this._demandGroupIndex !== undefined\n                ? this._demandGroups[this._demandGroupIndex]\n                : ifDefined(undefined)}\n              demand-group-index=${ifDefined(this._demandGroupIndex)}\n            ></bldn-other-form>\n          `,\n        ],\n      ])}\n    `;\n  }\n\n  /**\n   * Go to request builder after an action is clicked\n   * @param e CustomEvent containing the clicked action\n   */\n  private selectAction(e: Event) {\n    e.stopPropagation();\n    const { value } = (e as CustomEvent).detail;\n    if (Object.values(PrivacyRequestDemand.action).includes(value)) {\n      this._action = value as PrivacyRequestDemand.action;\n\n      // We want the request builder for a new demand group (not editing existing)\n      this._demandGroupIndex = undefined;\n      this._uiState = RequestBuilderUIState.edit;\n    }\n  }\n\n  /**\n   * Add a new demand group or update an existing one\n   * @param e CustomEvent containing demands info\n   */\n  private setDemands(e: Event) {\n    e.stopPropagation();\n    const { demandGroupIndex, demands } = (e as CustomEvent).detail;\n    if (demandGroupIndex !== undefined) {\n      this._demandGroups[demandGroupIndex] = demands;\n    } else {\n      this._demandGroups.push(demands);\n    }\n  }\n\n  /**\n   * Delete an existing demand group\n   * @param e Event containing the index of the demand group to delete\n   */\n  private deleteDemands(e: Event) {\n    e.stopPropagation();\n    const { demandGroupIndex } = (e as CustomEvent).detail;\n    this._demandGroups.splice(demandGroupIndex, 1);\n    // Note: For now, we only support a single demand so when one is deleted\n    // we can just open the menu\n    this._uiState = RequestBuilderUIState.menu;\n  }\n\n  private editDemands(e: Event) {\n    e.stopPropagation();\n    const { demandGroupIndex } = (e as CustomEvent).detail;\n    this._demandGroupIndex = demandGroupIndex;\n    this._uiState = RequestBuilderUIState.edit;\n  }\n\n  private handleCancelRequest(e: Event) {\n    e.stopPropagation();\n\n    // Reset states\n    this._action = undefined;\n    this._demandGroupIndex = undefined;\n    this._demandGroups = [];\n    this._uiState = RequestBuilderUIState.menu;\n  }\n\n  private handleSubmitRequest(e: Event) {\n    e.stopPropagation();\n\n    const { target } = (e as CustomEvent).detail;\n\n    // Build privacy request object\n    const request: CreatePrivacyRequestPayload = {\n      demands: this._demandGroups.flat(),\n      ...(target !== undefined && { target }),\n    };\n\n    // Add data subject if we have a token\n    if (ComputationAPI.getInstance().apiTokenSet()) {\n      const decodedToken = JSON.parse(decode(this.apiToken.split('.')[1]));\n      request.data_subject = [\n        {\n          id: decodedToken.uid,\n          schema: 'dsid',\n        },\n      ];\n    }\n\n    // Emit privacy request\n    this.dispatchEvent(\n      new CustomEvent('bldn-request-builder:request-created', {\n        bubbles: true,\n        composed: true,\n        detail: {\n          request,\n        },\n      })\n    );\n\n    // Send request and emit event with ID\n    ComputationAPI.getInstance()\n      .sendPrivacyRequest(request)\n      .then(response => {\n        this.dispatchEvent(\n          new CustomEvent('bldn-request-builder:request-sent', {\n            bubbles: true,\n            composed: true,\n            detail: {\n              requestId: response.request_id,\n            },\n          })\n        );\n      });\n  }\n\n  private handleBackClick(e: Event) {\n    e.stopPropagation();\n    // Reset states\n    // Note: For now we do this when back is clicked as we don't fully\n    // support multiple demands yet\n    this._action = undefined;\n    this._demandGroupIndex = undefined;\n    this._demandGroups = [];\n    this._uiState = RequestBuilderUIState.menu;\n  }\n\n  private handleReviewClick(e: Event) {\n    e.stopPropagation();\n    this._uiState = RequestBuilderUIState.review;\n  }\n\n  private updateDataCategories() {\n    // FIXME: For now, use default data categories\n    // eslint-disable-next-line no-constant-condition\n    if (this.apiToken && false) {\n      ComputationAPI.getInstance()\n        .getDataCategories()\n        .then(response => {\n          const allDataCategories: string[] = response.map(\n            dc => dc.data_category\n          );\n\n          // Filter all possible data categories to only include those from the dataCategories property\n          if (this.dataCategories.length > 0) {\n            this._allowedDataCategories = allDataCategories.filter(dc =>\n              this.dataCategories.includes(dc)\n            );\n          } else {\n            // If data categories to allow was not specified, include all non-subcategories\n            this._allowedDataCategories = allDataCategories.filter(\n              dc => !dc.includes('.')\n            );\n          }\n        });\n    } else {\n      this._allowedDataCategories = Object.values(DefaultDataCategories);\n      // TODO: Set to some default data categories\n    }\n\n    // Compare all allowed data categories with those passed in\n    const lowerCaseDataCategories = this.dataCategories.map(dc =>\n      dc.toLowerCase()\n    );\n    const selectedCategories = this._allowedDataCategories.filter(\n      dc => lowerCaseDataCategories.includes(dc.toLowerCase()) || dc === '*'\n    );\n    if (selectedCategories.length > 0) {\n      this._allowedDataCategories = selectedCategories;\n    }\n  }\n\n  /**\n   * Filter our list of actions based on those passed in\n   */\n  private handleActionsChange() {\n    const lowerCaseActions = this.actions.map(a => a.toLowerCase());\n    const selectedActions = this._allowedActions.filter(a =>\n      lowerCaseActions.includes(a.toLowerCase())\n    );\n    if (selectedActions.length > 0) {\n      this._allowedActions = selectedActions;\n    }\n  }\n\n  private handleTokenChange() {\n    this.updateDataCategories();\n  }\n\n  connectedCallback(): void {\n    // eslint-disable-next-line wc/guard-super-call\n    super.connectedCallback();\n\n    // Action menu listeners\n    this.addEventListener('bldn-tile-menu:tile-click', this.selectAction);\n\n    // Request builder listeners\n    this.addEventListener('bldn-action-form:set-demands', this.setDemands);\n    this.addEventListener('bldn-action-form:back-click', this.handleBackClick);\n    this.addEventListener(\n      'bldn-action-form:next-click',\n      this.handleReviewClick\n    );\n\n    // Request review listeners\n    this.addEventListener(\n      'bldn-request-review:delete-demands',\n      this.deleteDemands\n    );\n    this.addEventListener('bldn-request-review:edit-demands', this.editDemands);\n    this.addEventListener(\n      'bldn-request-review:cancel-request',\n      this.handleCancelRequest\n    );\n    this.addEventListener(\n      'bldn-request-review:submit-request',\n      this.handleSubmitRequest\n    );\n  }\n\n  disconnectedCallback(): void {\n    this.removeEventListener('bldn-tile-menu:tile-click', this.selectAction);\n    this.removeEventListener('bldn-action-form:set-demands', this.setDemands);\n    this.removeEventListener(\n      'bldn-request-review:delete-demands',\n      this.deleteDemands\n    );\n    this.removeEventListener(\n      'bldn-request-review:edit-demands',\n      this.editDemands\n    );\n    this.removeEventListener(\n      'bldn-request-review:cancel-request',\n      this.handleCancelRequest\n    );\n    this.removeEventListener(\n      'bldn-request-review:submit-request',\n      this.handleSubmitRequest\n    );\n    this.removeEventListener(\n      'bldn-action-form:back-click',\n      this.handleBackClick\n    );\n    this.removeEventListener(\n      'bldn-action-form:next-click',\n      this.handleReviewClick\n    );\n  }\n\n  protected willUpdate(\n    _changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>\n  ): void {\n    super.willUpdate(_changedProperties);\n    if (_changedProperties.has('actions')) this.handleActionsChange();\n    if (_changedProperties.has('dataCategories')) this.updateDataCategories();\n    if (_changedProperties.has('apiToken')) this.handleTokenChange();\n  }\n\n  render() {\n    return html`\n      ${choose(this._uiState, [\n        [\n          RequestBuilderUIState.menu,\n          () => html`\n            <bldn-tile-menu\n              .tiles=${this._allowedActions\n                .filter(a => !a.includes('.'))\n                .map(a => ({\n                  title: ACTION_TITLES[a](),\n                  description: ACTION_DESCRIPTIONS[a](),\n                  value: a,\n                }))}\n            ></bldn-tile-menu>\n          `,\n        ],\n        [\n          RequestBuilderUIState.edit,\n          () =>\n            this.getActionForm(\n              this._action ?? PrivacyRequestDemand.action.ACCESS\n            ),\n        ],\n        [\n          RequestBuilderUIState.review,\n          () => html`\n            <bldn-request-review\n              .demandGroups=${this._demandGroups}\n            ></bldn-request-review>\n          `,\n        ],\n      ])}\n    `;\n  }\n\n  static styles = css`\n    :host {\n      display: block;\n      width: 100%;\n    }\n  `;\n}\n"],"names":[],"mappings":"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"}