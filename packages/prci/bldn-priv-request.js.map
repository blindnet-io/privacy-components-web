{"version":3,"file":"bldn-priv-request.js","sources":["../src/bldn-priv-request.ts"],"sourcesContent":["import {\n  CoreConfigurationMixin,\n  PrivacyRequestDemand,\n  bldnStyles,\n} from '@blindnet/core';\nimport { localized } from '@lit/localize';\nimport { css, html, LitElement, PropertyValueMap } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\n\nimport './bldn-request-builder.js';\nimport './bldn-submitted-requests.js';\nimport { setLocale } from './localization.js';\n\nenum PRCIUIState {\n  createRequest,\n  submittedRequests,\n}\n\n@localized()\n@customElement('bldn-priv-request')\nexport class BldnPrivRequest extends CoreConfigurationMixin(LitElement) {\n  /** @prop */\n  @property({ type: Array }) actions: PrivacyRequestDemand.action[] = [];\n\n  /** @prop */\n  @property({ type: Array, attribute: 'data-categories' })\n  dataCategories: string[] = [];\n\n  /** @prop */\n  @property({ type: Array }) requestId: undefined | string;\n\n  @state() _uiState: PRCIUIState = PRCIUIState.createRequest;\n\n  constructor() {\n    super();\n\n    // Set locale if current one is supported\n    try {\n      setLocale(navigator.language);\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.log(`Could not set locale to ${navigator.language}.`);\n    }\n\n    // Check if a requestId passed\n    const url = new URL(window.location.href);\n    const requestId = url.searchParams.get('requestId');\n    if (requestId) {\n      // Remove requestId from the URL after setting it\n      this.requestId = requestId;\n      url.searchParams.delete('requestId');\n      window.history.replaceState({}, '', url.href);\n    }\n  }\n\n  handleRequestIdChange() {\n    this._uiState = PRCIUIState.submittedRequests;\n  }\n\n  handleRequestSent(e: Event) {\n    const { requestId } = (e as CustomEvent).detail;\n    this.requestId = requestId;\n  }\n\n  handleNavClick(e: Event) {\n    const { value } = (e as CustomEvent).detail;\n    if (value === 'create') {\n      this._uiState = PRCIUIState.createRequest;\n    } else {\n      this.requestId = undefined;\n      this._uiState = PRCIUIState.submittedRequests;\n    }\n  }\n\n  protected willUpdate(\n    _changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>\n  ): void {\n    super.willUpdate(_changedProperties);\n    if (_changedProperties.has('requestId')) this.handleRequestIdChange();\n  }\n\n  render() {\n    return html`\n      <bldn-nav-toggle\n        .left=${{\n          label: 'Submit a Request',\n          value: 'create',\n          checked: this._uiState === PRCIUIState.createRequest,\n        }}\n        .right=${{\n          label: 'Submitted Requests',\n          value: 'submitted',\n          checked: this._uiState === PRCIUIState.submittedRequests,\n        }}\n        @bldn-nav-toggle:click=${this.handleNavClick}\n      ></bldn-nav-toggle>\n      ${choose(this._uiState, [\n        [\n          PRCIUIState.createRequest,\n          () =>\n            html`\n              <bldn-request-builder\n                api-token=${ifDefined(this.apiToken)}\n                data-categories=${JSON.stringify(this.dataCategories)}\n                actions=${JSON.stringify(this.actions)}\n                @bldn-request-builder:request-sent=${this.handleRequestSent}\n              ></bldn-request-builder>\n            `,\n        ],\n        [\n          PRCIUIState.submittedRequests,\n          () => html`\n            <bldn-submitted-requests\n              request-id=${ifDefined(this.requestId)}\n            ></bldn-submitted-requests>\n          `,\n        ],\n      ])}\n    `;\n  }\n\n  static styles = [\n    bldnStyles,\n    css`\n      :host {\n        display: block;\n        width: 100%;\n        background: var(--bldn-privacy-request-background, var(--background));\n      }\n\n      bldn-request-builder,\n      bldn-submitted-requests {\n        margin-top: 2.5em;\n      }\n\n      bldn-submitted-requests {\n        padding: 0 10%;\n      }\n    `,\n  ];\n}\n"],"names":[],"mappings":"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"}