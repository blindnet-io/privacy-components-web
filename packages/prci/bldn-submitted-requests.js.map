{"version":3,"file":"bldn-submitted-requests.js","sources":["../src/bldn-submitted-requests.ts"],"sourcesContent":["import { ComputationAPI, CoreConfigurationMixin, PrItem } from '@blindnet/core';\nimport { localized, msg } from '@lit/localize';\nimport { css, html, LitElement, PropertyValueMap } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { when } from 'lit/directives/when.js';\n\nimport './bldn-submitted-requests-list.js';\nimport './bldn-request-status.js';\n\nconst backSvg = new URL(\n  './assets/icons/eva_arrow-back-outline.svg',\n  import.meta.url\n).href;\n\nenum RequestsUIState {\n  requestsList,\n  requestStatus,\n}\n\n@localized()\n@customElement('bldn-submitted-requests')\nexport class BldnSubmittedRequests extends CoreConfigurationMixin(LitElement) {\n  @property({ type: String, attribute: 'request-id' }) requestId:\n    | string\n    | undefined;\n\n  @state() _requests: PrItem[] | undefined;\n\n  @state() _requestFilter: 'all' | 'pending' | 'answered' | 'canceled' = 'all';\n\n  @state() _uiState: RequestsUIState = RequestsUIState.requestsList;\n\n  @state() _selectedRequest: string | undefined;\n\n  handleRequestsCategoryChange(e: Event) {\n    e.stopPropagation();\n    const { value } = (e as CustomEvent).detail;\n    this._requestFilter = value;\n  }\n\n  handleRequestClick(e: Event) {\n    e.stopPropagation();\n    const { value } = (e as CustomEvent).detail;\n    this._selectedRequest = value;\n    this._uiState = RequestsUIState.requestStatus;\n  }\n\n  handleBackClick() {\n    this._uiState = RequestsUIState.requestsList;\n    this.getRequests();\n  }\n\n  /**\n   * Get submitted requests once we have a token\n   */\n  getRequests() {\n    ComputationAPI.getInstance()\n      .getRequestHistory()\n      .then(submittedRequests => {\n        this._requests = submittedRequests.history ?? [];\n      });\n  }\n\n  getRequestsToDisplay() {\n    if (this._requests !== undefined) {\n      switch (this._requestFilter) {\n        case 'all':\n          return this._requests;\n\n        case 'pending':\n          return this._requests.filter(\n            r => r.status === PrItem.status.IN_PROCESSING\n          );\n\n        case 'answered':\n          return this._requests.filter(\n            r => r.status === PrItem.status.COMPLETED\n          );\n\n        case 'canceled':\n          return this._requests.filter(\n            r => r.status === PrItem.status.CANCELED\n          );\n\n        default:\n          return this._requests;\n      }\n    }\n    return this._requests;\n  }\n\n  goToStatus() {\n    this._selectedRequest = this.requestId;\n    this._uiState = RequestsUIState.requestStatus;\n  }\n\n  protected willUpdate(\n    _changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>\n  ): void {\n    if (_changedProperties.has('apiToken') && this.apiToken) this.getRequests();\n    if (_changedProperties.has('requestId') && this.requestId)\n      this.goToStatus();\n  }\n\n  connectedCallback(): void {\n    // eslint-disable-next-line wc/guard-super-call\n    super.connectedCallback();\n    if (ComputationAPI.getInstance().apiTokenSet()) this.getRequests();\n  }\n\n  render() {\n    return html`\n      ${when(\n        this._uiState === RequestsUIState.requestsList,\n        () => html`\n          <bldn-horizontal-list\n            .choices=${[\n              {\n                value: 'all',\n                display: msg('All'),\n              },\n              {\n                value: 'pending',\n                display: msg('Pending'),\n              },\n              {\n                value: 'answered',\n                display: msg('Answered'),\n              },\n              {\n                value: 'canceled',\n                display: msg('Canceled'),\n              },\n            ]}\n            @bldn-horizontal-list:choice-change=${this\n              .handleRequestsCategoryChange}\n          ></bldn-horizontal-list>\n          <bldn-submitted-requests-list\n            .requests=${this.getRequestsToDisplay()}\n            @bldn-submitted-requests-list:request-click=${this\n              .handleRequestClick}\n          >\n          </bldn-submitted-requests-list>\n        `,\n        () => html`\n        <bldn-button mode='link-icon' underline-mode='none' @bldn-button:click=${\n          this.handleBackClick\n        }>\n          <img src=${backSvg} alt='back to requests'></img>\n          <span id='back-button'><b>${msg('Back to Requests')}</b></span>\n        </bldn-button>\n        <bldn-request-status\n          .requestId=${this._selectedRequest}\n        ></bldn-request-status>\n      `\n      )}\n    `;\n  }\n\n  static styles = css`\n    :host {\n      display: block;\n    }\n\n    bldn-horizontal-list {\n      margin-bottom: 1.75em;\n    }\n\n    #back-button {\n      color: var(--color-darkest);\n    }\n\n    bldn-request-status {\n      margin-top: 1.75em;\n    }\n  `;\n}\n"],"names":[],"mappings":";;;;;;;;;AASA,MAAM,OAAO,GAAG,IAAI,GAAG,CACrB,kEAA2C,EAC3C,MAAM,CAAC,IAAI,CAAC,GAAG,CAChB,CAAC,IAAI,CAAC;AAEP,IAAK,eAGJ,CAAA;AAHD,CAAA,UAAK,eAAe,EAAA;AAClB,IAAA,eAAA,CAAA,eAAA,CAAA,cAAA,CAAA,GAAA,CAAA,CAAA,GAAA,cAAY,CAAA;AACZ,IAAA,eAAA,CAAA,eAAA,CAAA,eAAA,CAAA,GAAA,CAAA,CAAA,GAAA,eAAa,CAAA;AACf,CAAC,EAHI,eAAe,KAAf,eAAe,GAGnB,EAAA,CAAA,CAAA,CAAA;AAIY,IAAA,qBAAqB,GAA3B,MAAM,qBAAsB,SAAQ,sBAAsB,CAAC,UAAU,CAAC,CAAA;AAAtE,IAAA,WAAA,GAAA;;QAOI,IAAc,CAAA,cAAA,GAAgD,KAAK,CAAC;AAEpE,QAAA,IAAA,CAAA,QAAQ,GAAoB,eAAe,CAAC,YAAY,CAAC;KAkJnE;AA9IC,IAAA,4BAA4B,CAAC,CAAQ,EAAA;QACnC,CAAC,CAAC,eAAe,EAAE,CAAC;AACpB,QAAA,MAAM,EAAE,KAAK,EAAE,GAAI,CAAiB,CAAC,MAAM,CAAC;AAC5C,QAAA,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;KAC7B;AAED,IAAA,kBAAkB,CAAC,CAAQ,EAAA;QACzB,CAAC,CAAC,eAAe,EAAE,CAAC;AACpB,QAAA,MAAM,EAAE,KAAK,EAAE,GAAI,CAAiB,CAAC,MAAM,CAAC;AAC5C,QAAA,IAAI,CAAC,gBAAgB,GAAG,KAAK,CAAC;AAC9B,QAAA,IAAI,CAAC,QAAQ,GAAG,eAAe,CAAC,aAAa,CAAC;KAC/C;IAED,eAAe,GAAA;AACb,QAAA,IAAI,CAAC,QAAQ,GAAG,eAAe,CAAC,YAAY,CAAC;QAC7C,IAAI,CAAC,WAAW,EAAE,CAAC;KACpB;AAED;;AAEG;IACH,WAAW,GAAA;QACT,cAAc,CAAC,WAAW,EAAE;AACzB,aAAA,iBAAiB,EAAE;aACnB,IAAI,CAAC,iBAAiB,IAAG;;YACxB,IAAI,CAAC,SAAS,GAAG,CAAA,EAAA,GAAA,iBAAiB,CAAC,OAAO,MAAI,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAA,EAAE,CAAC;AACnD,SAAC,CAAC,CAAC;KACN;IAED,oBAAoB,GAAA;AAClB,QAAA,IAAI,IAAI,CAAC,SAAS,KAAK,SAAS,EAAE;YAChC,QAAQ,IAAI,CAAC,cAAc;AACzB,gBAAA,KAAK,KAAK;oBACR,OAAO,IAAI,CAAC,SAAS,CAAC;AAExB,gBAAA,KAAK,SAAS;oBACZ,OAAO,IAAI,CAAC,SAAS,CAAC,MAAM,CAC1B,CAAC,IAAI,CAAC,CAAC,MAAM,KAAK,MAAM,CAAC,MAAM,CAAC,aAAa,CAC9C,CAAC;AAEJ,gBAAA,KAAK,UAAU;oBACb,OAAO,IAAI,CAAC,SAAS,CAAC,MAAM,CAC1B,CAAC,IAAI,CAAC,CAAC,MAAM,KAAK,MAAM,CAAC,MAAM,CAAC,SAAS,CAC1C,CAAC;AAEJ,gBAAA,KAAK,UAAU;oBACb,OAAO,IAAI,CAAC,SAAS,CAAC,MAAM,CAC1B,CAAC,IAAI,CAAC,CAAC,MAAM,KAAK,MAAM,CAAC,MAAM,CAAC,QAAQ,CACzC,CAAC;AAEJ,gBAAA;oBACE,OAAO,IAAI,CAAC,SAAS,CAAC;AACzB,aAAA;AACF,SAAA;QACD,OAAO,IAAI,CAAC,SAAS,CAAC;KACvB;IAED,UAAU,GAAA;AACR,QAAA,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,SAAS,CAAC;AACvC,QAAA,IAAI,CAAC,QAAQ,GAAG,eAAe,CAAC,aAAa,CAAC;KAC/C;AAES,IAAA,UAAU,CAClB,kBAAqE,EAAA;QAErE,IAAI,kBAAkB,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC,QAAQ;YAAE,IAAI,CAAC,WAAW,EAAE,CAAC;QAC5E,IAAI,kBAAkB,CAAC,GAAG,CAAC,WAAW,CAAC,IAAI,IAAI,CAAC,SAAS;YACvD,IAAI,CAAC,UAAU,EAAE,CAAC;KACrB;IAED,iBAAiB,GAAA;;QAEf,KAAK,CAAC,iBAAiB,EAAE,CAAC;AAC1B,QAAA,IAAI,cAAc,CAAC,WAAW,EAAE,CAAC,WAAW,EAAE;YAAE,IAAI,CAAC,WAAW,EAAE,CAAC;KACpE;IAED,MAAM,GAAA;AACJ,QAAA,OAAO,IAAI,CAAA,CAAA;AACP,MAAA,EAAA,IAAI,CACJ,IAAI,CAAC,QAAQ,KAAK,eAAe,CAAC,YAAY,EAC9C,MAAM,IAAI,CAAA,CAAA;;AAEK,qBAAA,EAAA;AACT,YAAA;AACE,gBAAA,KAAK,EAAE,KAAK;AACZ,gBAAA,OAAO,EAAE,GAAG,CAAC,KAAK,CAAC;AACpB,aAAA;AACD,YAAA;AACE,gBAAA,KAAK,EAAE,SAAS;AAChB,gBAAA,OAAO,EAAE,GAAG,CAAC,SAAS,CAAC;AACxB,aAAA;AACD,YAAA;AACE,gBAAA,KAAK,EAAE,UAAU;AACjB,gBAAA,OAAO,EAAE,GAAG,CAAC,UAAU,CAAC;AACzB,aAAA;AACD,YAAA;AACE,gBAAA,KAAK,EAAE,UAAU;AACjB,gBAAA,OAAO,EAAE,GAAG,CAAC,UAAU,CAAC;AACzB,aAAA;AACF,SAAA,CAAA;kDACqC,IAAI;aACvC,4BAA4B,CAAA;;;wBAGnB,IAAI,CAAC,oBAAoB,EAAE,CAAA;0DACO,IAAI;aAC/C,kBAAkB,CAAA;;;AAGxB,QAAA,CAAA,EACD,MAAM,IAAI,CAAA,CAAA;AAER,+EAAA,EAAA,IAAI,CAAC,eACP,CAAA;qBACa,OAAO,CAAA;sCACU,GAAG,CAAC,kBAAkB,CAAC,CAAA;;;AAGtC,qBAAA,EAAA,IAAI,CAAC,gBAAgB,CAAA;;OAErC,CACA,CAAA;KACF,CAAC;KACH;;AAEM,qBAAM,CAAA,MAAA,GAAG,GAAG,CAAA,CAAA;;;;;;;;;;;;;;;;GAgBlB,CAAC;AAzJmD,UAAA,CAAA;IAApD,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,SAAS,EAAE,YAAY,EAAE,CAAC;AAEtC,CAAA,EAAA,qBAAA,CAAA,SAAA,EAAA,WAAA,EAAA,KAAA,CAAA,CAAA,CAAA;AAEL,UAAA,CAAA;AAAR,IAAA,KAAK,EAAE;AAAiC,CAAA,EAAA,qBAAA,CAAA,SAAA,EAAA,WAAA,EAAA,KAAA,CAAA,CAAA,CAAA;AAEhC,UAAA,CAAA;AAAR,IAAA,KAAK,EAAE;AAAqE,CAAA,EAAA,qBAAA,CAAA,SAAA,EAAA,gBAAA,EAAA,KAAA,CAAA,CAAA,CAAA;AAEpE,UAAA,CAAA;AAAR,IAAA,KAAK,EAAE;AAA0D,CAAA,EAAA,qBAAA,CAAA,SAAA,EAAA,UAAA,EAAA,KAAA,CAAA,CAAA,CAAA;AAEzD,UAAA,CAAA;AAAR,IAAA,KAAK,EAAE;AAAsC,CAAA,EAAA,qBAAA,CAAA,SAAA,EAAA,kBAAA,EAAA,KAAA,CAAA,CAAA,CAAA;AAXnC,qBAAqB,GAAA,UAAA,CAAA;AAFjC,IAAA,SAAS,EAAE;IACX,aAAa,CAAC,yBAAyB,CAAC;AAC5B,CAAA,EAAA,qBAAqB,CA2JjC;;;;"}