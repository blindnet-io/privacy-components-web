{"version":3,"file":"DemandForm.js","sources":["../../src/demand-forms/DemandForm.ts"],"sourcesContent":["import { msg } from '@lit/localize';\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  PropertyValueMap,\n  TemplateResult,\n} from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { Demand, ACTION } from '@blindnet/core';\nimport { PRCIStyles } from '../styles.js';\nimport { ComponentState, DemandState } from '../utils/states.js';\n\n/**\n * Abstract class for a form that allows the user to create or edit a demand.\n */\nexport abstract class DemandForm extends LitElement {\n  static styles = [\n    PRCIStyles,\n    css`\n      :host {\n        margin: 0px;\n      }\n\n      .btns-ctr {\n        display: grid;\n        grid-template-columns: 1fr auto 1fr;\n        padding: 0px 0px 0px 0px;\n        margin: 0px 0px 0px 0px;\n        transform: translateY(35px);\n      }\n\n      #back-btn {\n        grid-column: 1/2;\n        min-width: 60%;\n        max-width: 300px;\n      }\n\n      #add-btn {\n        grid-column: 3/4;\n        min-width: 60%;\n        max-width: 300px;\n      }\n    ` as CSSResultGroup,\n  ];\n\n  @property({ type: Number, attribute: 'demand-state' })\n  demandState: DemandState = DemandState.EDIT_OPEN;\n\n  @property({ attribute: false }) demand: Demand = { action: ACTION.ACCESS };\n\n  // eslint-disable-next-line no-restricted-globals\n  @property({ type: String }) demandGroupId = self.crypto.randomUUID();\n\n  @property({ type: Boolean }) default = false;\n\n  /**\n   * Send this demand up to the top level component to add to the Privacy Request\n   * @param demandGroupId uuid of this demand group\n   * @param demand demand to add\n   */\n  addToPrivacyRequest(demandGroupId: string, demand: Demand) {\n    this.dispatchEvent(\n      new CustomEvent('demand-set', {\n        bubbles: true,\n        composed: true,\n        detail: {\n          demandGroupId,\n          demand,\n        },\n      })\n    );\n  }\n\n  /**\n   * Go back to the action menu\n   */\n  handleBackClick() {\n    this.dispatchEvent(\n      new CustomEvent('component-state-change', {\n        bubbles: true,\n        composed: true,\n        detail: {\n          newState: ComponentState.MENU,\n        },\n      })\n    );\n  }\n\n  /**\n   * Validate and add demand to request when add clicked\n   */\n  handleAddClick() {\n    if (this.validate()) {\n      this.addToPrivacyRequest(this.demandGroupId, this.demand);\n      this.dispatchEvent(\n        new CustomEvent('component-state-change', {\n          bubbles: true,\n          composed: true,\n          detail: {\n            newState: ComponentState.REVIEW,\n          },\n        })\n      );\n    }\n  }\n\n  /**\n   * Validate data entered before adding to Privacy Request\n   */\n  abstract validate(): boolean;\n\n  /**\n   * Get the edit template for this action\n   * @param useDefault Indicates if form should be populated with default values or from input demands\n   * @returns HTML template\n   */\n  abstract getFormTemplate(demand: Demand): TemplateResult;\n\n  abstract getDefaultDemand(): Demand;\n\n  protected willUpdate(\n    _changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>\n  ): void {\n    if (_changedProperties.has('default') && this.default) {\n      this.demand = this.getDefaultDemand();\n    }\n  }\n\n  render(): TemplateResult<1 | 2> {\n    return html`\n      <div>\n        ${choose(this.demandState, [\n          [DemandState.EDIT_OPEN, () => this.getFormTemplate(this.demand)],\n        ])}\n      </div>\n      <!-- Buttons -->\n      <div class=\"btns-ctr\">\n        <button\n          id=\"back-btn\"\n          class=\"nav-btn btn--centered btn--clickable\"\n          @click=${this.handleBackClick}\n        >\n          ${msg('Back')}\n        </button>\n        <button\n          id=\"add-btn\"\n          class=\"nav-btn btn--centered btn--clickable\"\n          @click=${this.handleAddClick}\n        >\n          ${msg('Next')}\n        </button>\n      </div>\n    `;\n  }\n}\n"],"names":[],"mappings":"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"}