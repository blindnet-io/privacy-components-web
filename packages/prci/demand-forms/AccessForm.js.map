{"version":3,"file":"AccessForm.js","sources":["../../src/demand-forms/AccessForm.ts"],"sourcesContent":["import { msg } from '@lit/localize';\nimport { css, html, TemplateResult } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport {\n  ACTION,\n  DATA_CATEGORY,\n  PROCESSING_CATEGORY,\n  PROVENANCE,\n  PURPOSE,\n  TARGET,\n  Demand,\n} from '@blindnet/core';\nimport {\n  DATA_CATEGORY_DESCRIPTIONS,\n  PROVENANCE_DESCRIPTIONS,\n  TARGET_DESCRIPTIONS,\n} from '../utils/dictionary.js';\nimport { DemandForm } from './DemandForm.js';\nimport { FormComponentState } from '../utils/states.js';\nimport '../AllChecklist.js';\nimport { PRCIStyles } from '../styles.js';\n\n/**\n * ActionForm for the Access PRIV action. Includes a dropdown and text element.\n */\n@customElement('access-form')\nexport class AccessForm extends DemandForm {\n  static styles = [\n    DemandForm.styles,\n    PRCIStyles,\n    css`\n      #access-form {\n        display: grid;\n        row-gap: 35px;\n        align-content: flex-start;\n        margin: 0px;\n      }\n\n      .access-options {\n        padding: 40px 40px 20px 40px;\n      }\n\n      #dmd-ctr {\n        display: grid;\n        row-gap: 20px;\n      }\n\n      #dmd-ctr ul {\n        margin: 0;\n      }\n\n      #dmd-ctr li:not(:last-child) {\n        margin-bottom: 15px;\n      }\n\n      #edit-heading-1 {\n        font-weight: bold;\n        grid-column: 1/2;\n        padding: 0px;\n      }\n\n      p {\n        margin: 0px;\n      }\n\n      .additional-msg-ctr {\n        display: grid;\n        row-gap: 20px;\n        margin: 0px 0px 25px 0px;\n      }\n    `,\n  ];\n\n  @property({ type: Array, attribute: false })\n  allowedDataCategories: DATA_CATEGORY[] = [];\n\n  constructor() {\n    super();\n\n    // Access data category listeners\n    this.addEventListener('access-option-select', e => {\n      const { id } = (e as CustomEvent).detail;\n      this.demand.restrictions!.privacy_scope!.push({\n        dc: id as DATA_CATEGORY,\n        pc: PROCESSING_CATEGORY.ALL,\n        pp: PURPOSE.ALL,\n      });\n    });\n    this.addEventListener('access-option-deselect', e => {\n      const { id } = (e as CustomEvent).detail;\n      this.demand.restrictions!.privacy_scope!.splice(\n        this.demand.restrictions!.privacy_scope!.findIndex(\n          psr => psr.dc === (id as DATA_CATEGORY)\n        ),\n        1\n      );\n    });\n\n    // FIXME: Disabled until we resolve how to handle OTHER-DATA\n    // this.addEventListener('access-option-other-click', e => {\n    //   const { checked } = (e as CustomEvent).detail;\n    //   if (checked) {\n    //     this.demand.dataCategory?.add(DATA_CATEGORY['OTHER-DATA']);\n    //   } else {\n    //     this.demand.dataCategory?.delete(DATA_CATEGORY['OTHER-DATA']);\n    //   }\n    // });\n    // this.addEventListener('access-option-other-input', e => {\n    //   const { text } = (e as CustomEvent).detail\n    //   // TODO: What demand field to put the other-data category\n    // })\n  }\n\n  handleAdditionalMessageInput(e: Event) {\n    const { value } = e.target as HTMLTextAreaElement;\n    this.demand.message = value;\n  }\n\n  handleProvenanceTermClick(e: Event) {\n    const { id } = (e as CustomEvent).target as HTMLInputElement;\n    this.demand.restrictions!.provenance!.term = id as PROVENANCE;\n  }\n\n  handleProvenanceTargetClick(e: Event) {\n    const { id } = (e as CustomEvent).target as HTMLInputElement;\n    this.demand.restrictions!.provenance!.target = id as TARGET;\n  }\n\n  handleDateRestrictionInput(e: Event) {\n    const { id, value } = e.target as HTMLInputElement;\n    if (id === 'date-start') {\n      if (value) {\n        this.demand.restrictions!.date_range!.from = new Date(value);\n      } else {\n        // Value is false when user hits 'clear' button on date picker\n        delete this.demand.restrictions?.date_range?.from;\n      }\n    } else if (id === 'date-end') {\n      if (value) {\n        this.demand.restrictions!.date_range!.to = new Date(value);\n      } else {\n        delete this.demand.restrictions?.date_range?.to;\n      }\n    }\n  }\n\n  validate(): boolean {\n    return true;\n  }\n\n  getDefaultDemand(): Demand {\n    return {\n      action: ACTION.ACCESS,\n      restrictions: {\n        privacy_scope: this.allowedDataCategories.map(dc => ({\n          dc,\n          pc: PROCESSING_CATEGORY.ALL,\n          pp: PURPOSE.ALL,\n        })),\n        provenance: {\n          term: PROVENANCE.ALL,\n          target: TARGET.SYSTEM,\n        },\n        date_range: {},\n      },\n    };\n  }\n\n  getFormTemplate(demand: Demand): TemplateResult<1 | 2> {\n    return html`\n      <div id=\"access-form\">\n        <p id=\"edit-heading-1\">\n          <b>${msg('Details of my ACCESS Demand')}</b>\n        </p>\n\n        <div class=\"border--light border--rounded access-options\">\n          <span slot=\"prompt\">${msg('I want to access:')}</span>\n          <all-checklist\n            .choices=${this.allowedDataCategories.map(dc => ({\n              id: dc,\n              description: DATA_CATEGORY_DESCRIPTIONS[dc](),\n              checked:\n                demand.restrictions?.privacy_scope?.findIndex(\n                  psr => psr.dc === dc\n                ) !== -1,\n              disabled: false,\n            }))}\n            all-message=${msg(\n              'ALL categories of data the organization has data on me'\n            )}\n            component-mode=${FormComponentState.CLOSED}\n            event-prefix=\"access-option\"\n            include-buttons\n          ></all-checklist>\n        </div>\n\n        <slotted-dropdown header=${msg('Advanced settings')} include-buttons>\n          <div class=\"date-restriction\">\n            <p>\n              ${msg(\n                'Specify a date range for the selected category(ies) of data:'\n              )}\n            </p>\n            <div>\n              <span>${msg('From')}</span>\n              <input\n                id=\"date-start\"\n                type=\"date\"\n                .value=${demand.restrictions?.date_range?.from\n                  ? demand.restrictions?.date_range?.from\n                      .toISOString()\n                      .split('T')[0]\n                  : ''}\n                @input=${this.handleDateRestrictionInput}\n              />\n              <span>${msg('to')}</span>\n              <input\n                id=\"date-end\"\n                type=\"date\"\n                .value=${demand.restrictions?.date_range?.to\n                  ? demand.restrictions?.date_range?.to\n                      .toISOString()\n                      .split('T')[0]\n                  : ''}\n                @input=${this.handleDateRestrictionInput}\n              />\n            </div>\n          </div>\n          <div>\n            <span>\n              ${msg('My demand applies to data from the following provenance:')}\n            </span>\n            <fieldset class=\"provenance-restriction\">\n              ${Object.values(PROVENANCE).map(\n                p => html`\n                  <input\n                    id=${p}\n                    name='provenance-term'\n                    type='radio'\n                    ?checked=${demand.restrictions?.provenance?.term === p}\n                    @click=${this.handleProvenanceTermClick}>\n                  </input>\n                  <label for=${p}>${PROVENANCE_DESCRIPTIONS[p]()}</label><br/>\n                `\n              )}\n            </fieldset>\n          </div>\n          <div>\n            <span> ${msg('I address my demand to:')} </span>\n            <fieldset class=\"provenance-restriction\">\n              ${Object.values(TARGET)\n                .filter(t => t !== TARGET.ALL)\n                .map(\n                  t => html`\n                  <input\n                    id=${t}\n                    name='provenance-target'\n                    type='radio'\n                    ?checked=${demand.restrictions?.provenance?.target === t}\n                    @click=${this.handleProvenanceTargetClick}>\n                  </input>\n                  <label for=${t}>${TARGET_DESCRIPTIONS[t]()}</label><br/>\n                `\n                )}\n            </fieldset>\n          </div>\n        </slotted-dropdown>\n        <slotted-dropdown\n          header=${msg('Additional message (optional)')}\n          include-buttons\n        >\n          <div class=\"additional-msg-ctr\">\n            <span class=\"\">${msg('My additional message:')}</span>\n            <span\n              ><i\n                >${msg(\n                  'Please note that adding a personalized message might lead to the demand taking longer to be processed'\n                )}</i\n              ></span\n            >\n            <textarea\n              id=\"additional-msg\"\n              class=\"std-txt-area\"\n              name=\"paragraph_text\"\n              cols=\"50\"\n              rows=\"10\"\n              @input=${this.handleAdditionalMessageInput}\n              .value=${demand.message ?? ''}\n            ></textarea>\n          </div>\n        </slotted-dropdown>\n      </div>\n    `;\n  }\n}\n"],"names":[],"mappings":"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"}